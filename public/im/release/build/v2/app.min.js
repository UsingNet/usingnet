/**
 * @license almond 0.3.2 Copyright jQuery Foundation and other contributors.
 * Released under MIT license, http://github.com/requirejs/almond/LICENSE
 */

/**
 * @license RequireJS text 2.0.12 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
 * @version   3.2.1
 */

/*
 html2canvas 0.5.0-beta2 <http://html2canvas.hertzen.com>
 Copyright (c) 2015 Niklas von Hertzen

 Released under  License
 */

/*! https://mths.be/punycode v1.3.2 by @mathias */

/*
             * base64-arraybuffer
             * https://github.com/niklasvh/base64-arraybuffer
             *
             * Copyright (c) 2012 Niklas von Hertzen
             * Licensed under the MIT license.
             */

/*	SWFObject v2.2 <http://code.google.com/p/swfobject/> 
	is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> 
*/

var requirejs,require,define;(function(e){function h(e,t){return f.call(e,t)}function p(e,t){var n,r,i,s,o,a,f,l,h,p,d,v,m=t&&t.split("/"),g=u.map,y=g&&g["*"]||{};if(e){e=e.split("/"),o=e.length-1,u.nodeIdCompat&&c.test(e[o])&&(e[o]=e[o].replace(c,"")),e[0].charAt(0)==="."&&m&&(v=m.slice(0,m.length-1),e=v.concat(e));for(h=0;h<e.length;h++){d=e[h];if(d===".")e.splice(h,1),h-=1;else if(d===".."){if(h===0||h===1&&e[2]===".."||e[h-1]==="..")continue;h>0&&(e.splice(h-1,2),h-=2)}}e=e.join("/")}if((m||y)&&g){n=e.split("/");for(h=n.length;h>0;h-=1){r=n.slice(0,h).join("/");if(m)for(p=m.length;p>0;p-=1){i=g[m.slice(0,p).join("/")];if(i){i=i[r];if(i){s=i,a=h;break}}}if(s)break;!f&&y&&y[r]&&(f=y[r],l=h)}!s&&f&&(s=f,a=l),s&&(n.splice(0,a,s),e=n.join("/"))}return e}function d(t,r){return function(){var i=l.call(arguments,0);return typeof i[0]!="string"&&i.length===1&&i.push(null),n.apply(e,i.concat([t,r]))}}function v(e){return function(t){return p(t,e)}}function m(e){return function(t){s[e]=t}}function g(n){if(h(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!h(s,n)&&!h(a,n))throw new Error("No "+n);return s[n]}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice,c=/\.js$/;r=function(e,t){var n,r=y(e),i=r[0];return e=r[1],i&&(i=p(i,t),n=g(i)),i?n&&n.normalize?e=n.normalize(e,v(t)):e=p(e,t):(e=p(e,t),r=y(e),i=r[0],e=r[1],i&&(n=g(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return d(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:b(e)}}},t=function(t,n,u,f){var l,c,p,v,y,b=[],w=typeof u,E;f=f||t;if(w==="undefined"||w==="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){v=r(n[y],f),c=v.f;if(c==="require")b[y]=i.require(t);else if(c==="exports")b[y]=i.exports(t),E=!0;else if(c==="module")l=b[y]=i.module(t);else if(h(s,c)||h(o,c)||h(a,c))b[y]=g(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,d(f,!0),m(c),{}),b[y]=s[c]}}p=u?u.apply(s[t],b):undefined;if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(p!==e||!E)s[t]=p}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){if(typeof s=="string")return i[s]?i[s](o):g(r(s,o).f);if(!s.splice){u=s,u.deps&&n(u.deps,u.callback);if(!o)return;o.splice?(s=o,o=a,a=null):s=e}return o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n},n.config=function(e){return n(e)},requirejs._defined=s,define=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!h(s,e)&&!h(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("../../../node_modules/almond/almond",function(){}),define("lib/ajax",[],function(){var e={},t="__using_root_key_"+(new Date).getTime().toString()+parseInt(Math.random()*1e4).toString();return window[t]={},e.get=function(t,n,r){e.send(t,"GET",n,r)},e.post=function(t,n,r){e.send(t,"POST",n,r)},e.send=function(e,t,n,r){var i=typeof XMLHttpRequest!="undefined"?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),s;if(n){var o=[];for(var u in n)o.push(u+"="+encodeURIComponent(n[u]));s=o.join("&")}t=="GET"?(i.open(t,e+"?"+s,!0),i.send()):(i.open(t,e,!0),s.length&&i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.send(s)),i.onreadystatechange=function(){if(i.readyState==4){var e=i.responseText;try{e=JSON.parse(e)}catch(t){}r&&r(e)}}},e.jsonp=function(e,n,r){var i="using_json_key_"+(new Date).getTime().toString()+parseInt(Math.random()*1e4).toString();n.callback=t+"."+i;if(n){var s=[];for(var o in n)s.push(o+"="+encodeURIComponent(n[o]));e=e+"?"+s.join("&")}var u=document.createElement("script");u.src=e,window[t][i]=function(e){try{document.body.removeChild(u)}catch(n){}try{r&&typeof r=="function"&&r(e)}catch(n){}delete window[t][i]},document.body.appendChild(u)},e}),define("lib/url",[],function(){var e={};return location.search.substr(1).split("&").filter(function(e){return e}).map(function(t){var n=t.split("=");e[n[0]]=decodeURIComponent(n[1])}),{search:function(t){return e[t]}}}),define("lib/template",[],function(){return new function(){var _dataList=null,_scanTemplateName=0,_scanCode="",_scanCodeIndex=0,_scanCodeChar="",_scanCodeLength=0,_scanCodeLine=0,_scanCodeCol=0,_codeConditionNested=0,_codeBlockNested=0,_codeState=0,_run=function(){_scanCodeIndex=0,_scanCodeLength=_scanCode.length,_scanCodeLine=0,_scanCodeCol=0,_codeState=0;var rString='var codeString = "";try{';while(_readChar())switch(_codeState){case 1:rString+='codeString += "'+_jsStringEncode(_readHTMLBlock())+'";';break;case 3:rString+=_readJTemplate()+";"}return rString+="}catch(e){console.log(e);}",eval(rString)},_readJTemplate=function(){_codeState==2&&_readChar();var e="";do{if(_codeState==4)return _decodeVar(e).replace(/echo/g,"codeString += ");e+=_scanCodeChar}while(_readChar());throw'JTemplate code should be end with "#>".'},_readHTMLBlock=function(){_codeState==4&&_readChar();var e="",t="";do{if(t=="<"&&_scanCodeChar=="#")return e;e+=t,t=_scanCodeChar}while(_readChar());return e+=t,e},_jsStringEncode=function(e){return e.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/\r/ig,"").replace(/\n/ig,"\\\n")},_readChar=function(){if(_scanCodeIndex<_scanCodeLength){var e=_scanCodeChar;return _scanCodeChar=_scanCode.substr(_scanCodeIndex,1),_codeState==0?_codeState=1:_codeState==1&&e=="<"&&_scanCodeChar=="#"?_codeState=2:_codeState==2?_codeState=3:_codeState==3&&_scanCodeChar=="#"?_codeState=4:_codeState==4&&e==">"&&(_codeState=1),_scanCodeChar=="\n"?(_scanCodeLine++,_scanCodeCol=0):_scanCodeChar=="("?_codeConditionNested++:_scanCodeChar==")"?_codeConditionNested--:_scanCodeChar=="{"?_codeBlockNested++:_scanCodeChar=="}"&&_codeBlockNested--,_scanCodeIndex++,_scanCodeCol++,_codeBlockNested<0&&_codeError("Code Block Nested Error"),_codeConditionNested<0&&_codeError("Code Condition Nested Error"),!0}return _scanCodeChar="",!1},_codeError=function(e){throw"JTemplate Code Error in Template["+_scanTemplateName+"] line "+_scanCodeLine+" char "+_scanCodeCol+": "+e+"."},_decodeVar=function(e){return e.replace(/\$([a-zA-Z_]+[a-zA-Z_])*?/g,"_dataList._$1")};return function(e,t){_scanCode=e,_dataList={};if(t!=null)for(var n in t)_dataList["_"+n]=t[n];return _run()}}}),define("text",["module"],function(e){"use strict";var t,n,r,i,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],u=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,f=typeof location!="undefined"&&location.href,l=f&&location.protocol&&location.protocol.replace(/\:/,""),c=f&&location.hostname,h=f&&(location.port||undefined),p={},d=e.config&&e.config()||{};t={version:"2.0.12",strip:function(e){if(e){e=e.replace(u,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;if(typeof ActiveXObject!="undefined")for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(r){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,s=e.indexOf("."),o=e.indexOf("./")===0||e.indexOf("../")===0;return s!==-1&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1,e.length)):t=e,r=n||t,s=r.indexOf("!"),s!==-1&&(i=r.substring(s+1)==="strip",r=r.substring(0,s),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var s,o,u,a=t.xdRegExp.exec(e);return a?(s=a[2],o=a[3],o=o.split(":"),u=o[1],o=o[0],(!s||s===n)&&(!o||o.toLowerCase()===r.toLowerCase())&&(!u&&!o||u===i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(p[e]=r),i(r)},load:function(e,n,r,i){if(i&&i.isBuild&&!i.inlineText){r();return}d.isBuild=i&&i.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),u=n.toUrl(o),a=d.useXhr||t.useXhr;if(u.indexOf("empty:")===0){r();return}!f||a(u,l,c,h)?t.get(u,function(n){t.finishLoad(e,s.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,r)})},write:function(e,n,r,i){if(p.hasOwnProperty(n)){var s=t.jsEscape(p[n]);r.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,r,i,s){var o=t.parseName(n),u=o.ext?"."+o.ext:"",a=o.moduleName+u,f=r.toUrl(o.moduleName+u)+".js";t.load(a,r,function(n){var r=function(e){return i(f,e)};r.asModule=function(e,t){return i.asModule(e,f,t)},t.write(e,a,r,s)},s)}};if(d.env==="node"||!d.env&&typeof process!="undefined"&&process.versions&&!!process.versions.node&&!process.versions["node-webkit"])n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");i.indexOf("﻿")===0&&(i=i.substring(1)),t(i)}catch(s){r&&r(s)}};else if(d.env==="xhr"||!d.env&&t.createXhr())t.get=function(e,n,r,i){var s=t.createXhr(),o;s.open("GET",e,!0);if(i)for(o in i)i.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),i[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(t){var i,o;s.readyState===4&&(i=s.status||0,i>399&&i<600?(o=new Error(e+" HTTP status: "+i),o.xhr=s,r&&r(o)):n(s.responseText),d.onXhrComplete&&d.onXhrComplete(s,e))},s.send(null)};else if(d.env==="rhino"||!d.env&&typeof Packages!="undefined"&&typeof java!="undefined")t.get=function(e,t){var n,r,i="utf-8",s=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),u=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(s),i)),a="";try{n=new java.lang.StringBuffer,r=u.readLine(),r&&r.length()&&r.charAt(0)===65279&&(r=r.substring(1)),r!==null&&n.append(r);while((r=u.readLine())!==null)n.append(o),n.append(r);a=String(n.toString())}finally{u.close()}t(a)};else if(d.env==="xpconnect"||!d.env&&typeof Components!="undefined"&&Components.classes&&Components.interfaces)r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in r,t.get=function(e,t){var n,o,u,a={};s&&(e=e.replace(/\//g,"\\")),u=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(u,1,0,!1),o=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),o.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),a),o.close(),n.close(),t(a.value)}catch(f){throw new Error((u&&u.path||"")+": "+f)}};return t}),define("text!theme.html",[],function(){return'<style type="text/css">\n    body, header, article{\n        background-color: #<# echo $chatWin_bg_color||"F9F9F9";#>;\n    }\n\n    textarea, footer{\n        background: #FFF;\n    }\n\n    header{\n        background-color:#<# echo $title_bg_color||"00A4F5"; #>;\n        color:#<# echo $title_txt_color||"FFF"; #>;\n    }\n    header a{\n        background-color:#<# echo $title_bg_color||"00A4F5"; #> !important;\n        color:#<# echo $title_txt_color||"FFF"; #> !important;\n    }\n    time{\n        color:#FFF;\n        background-color: #CCC;\n        font-size:0.9em;\n    }\n    section.send{\n        color:#<# echo $message_left_font_color||"000"; #>;\n        background-color: #<# echo $message_left_bg_color||"FFF"; #>;\n    }\n    section.send a{\n        color:#<# echo $message_left_font_color||"000"; #>;\n    }\n    article section.send:after{\n        background-color: #<# echo $message_left_bg_color||"FFF"; #>;\n    }\n    section.receive{\n        color:#<# echo $message_right_font_color||"FFF"; #>;\n        background-color: #<# echo $message_right_bg_color||"00A4F5"; #>;\n    }\n    section.receive a{\n        color:#<# echo $message_right_font_color||"FFF"; #>;\n    }\n    article section.receive:after{\n        background-color: #<# echo $message_right_bg_color||"EEE"; #>;\n    }\n    footer a{\n        background-color:#<# echo $button_bg_color||"00A4F5"; #> !important;\n        color:#<# echo $button_txt_color||"FFF"; #> !important;\n    }\n    footer nav .tools-button{\n        background-color:#<# echo $chatWin_bg_color||"FFF";#> !important;\n        color:#AAA !important;\n    }\n    div.lm{\n        background-color:#<# echo $chatWin_bg_color||"F9F9F9";#> !important;\n    }\n    div.lm form input[type=button],div.lm form button{\n        background-color:#<# echo $button_bg_color||"00A4F5"; #> !important;\n        color:#<# echo $button_txt_color||"FFF"; #> !important;\n    }\n    dialog{\n        border-top: 5px solid #<# echo $title_bg_color||"00A4F5"; #>;\n    }\n    .evaluation-submit {\n        background-color:#<# echo $title_bg_color||"00A4F5"; #>;\n        color:#<# echo $title_txt_color||"FFF"; #>;\n    }\n</style>'}),define("lib/class",[],function(){return function(){var e={};this.triggerEvent=function(t){var n=this,r=t.type;t.target=n,e[r]&&e[r].map(function(e){e.call(n,t)})},this.addEventListener=function(t,n){return e[t]||(e[t]=[]),e[t].push(n),!0},this.removeEventListener=function(t,n){return e[t]?(e[t].remove(n),!0):!1},this.extend=function(e){return e.prototype=this,e}}}),define("view/im/serviceGroup/ServiceGroup",["lib/class"],function(e){return(new e).extend(function(e){var t=document.createElement("div");t.id="displayAgentGroup",t.style.left=0,t.style.right=0,t.style.top="48px",t.style.bottom="82px",t.style.background="#fff",t.style.position="absolute",t.style.padding="20px";var n=e.groups,r="<h5>请先选择咨询内容</h5>";for(var i=0;i<n.length;i++)r+='<a href="javascript: void(0);" data-id="'+n[i].id+'" style="display: block; text-decoration: none; font-size: 14px; color: #2db7f5;">'+n[i].name+"</a>";t.innerHTML=r;var s=t.querySelectorAll("a");for(var o=0;o<s.length;o++)s[o].addEventListener("click",function(){var e=this.getAttribute("data-id");t.setAttribute("data-id",e),t.style.zIndex="-10000"},!1);this.appendTo=function(e){e.appendChild(t)}})}),define("text!view/common/header/Header.html",[],function(){return'<!-- <header> -->\n    <img class="logo" src="">\n    <address>\n        <span>团队名</span><br><em></em><i>正在为您服务</i>\n    </address>\n    <nav class="pull-right">\n        <a class="pure-button button-xsmall" title="全屏打开" target="_blank" style="display: <# echo $isMobile || "FFF"; #>" href="<# echo location.href #>"><span class="fa fa-share"></span></a>\n        <a class="pure-button button-xsmall" title="最小化" href="javascript:window.parent.postMessage(JSON.stringify({action:\'minimize\'}), \'*\');"><span class="fa fa-angle-double-down"></span></a>\n    </nav>\n<!-- </header> -->'}),define("lib/browser",[],function(){var e={isMobile:!!navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i),Browser:function(){var e=navigator.userAgent,t=Object.prototype.toString.call(window.opera)=="[object Opera]";return{IE:!!window.attachEvent&&!t,Opera:t,WebKit:e.indexOf("AppleWebKit/")>-1,Gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,MobileSafari:/Apple.*Mobile/.test(e)}}(),BrowserFeatures:{XPath:!!document.evaluate,SelectorsAPI:!!document.querySelector,ElementExtensions:function(){var e=window.Element||window.HTMLElement;return!!e&&!!e.prototype}(),SpecificElementExtensions:function(){if(typeof window.HTMLDivElement!="undefined")return!0;var e=document.createElement("div"),t=document.createElement("form"),n=!1;return e.__proto__&&e.__proto__!==t.__proto__&&(n=!0),e=t=null,n}()}};return e}),define("view/common/header/Header",["lib/class","text!./Header.html","lib/template","lib/browser"],function(e,t,n,r){var i=document.createElement("header");i.innerHTML=n(t,{isMobile:r.isMobile?"none":"inline"});var s=i.querySelector("address span"),o=i.querySelector("img.logo"),u=i.querySelector("nav");return window.self==window.top&&(u.style.display="none"),(new e).extend(function(){this.appendTo=function(e){e.appendChild(i)},this.setConfig=function(e){if(!e||!e.web)return!1;s.innerHTML=e.web.name,this.updateLogo(e.web.logo)},this.updateLogo=function(e){e&&(o.src=e+"-avatar")},this.getHeight=function(){return i.offsetHeight}})}),define("text!view/im/messagebox/MessageBox.html",[],function(){return'<!-- <article> -->\n<!--[Example[\n    <section class="time">\n        <time datetime="2016-01-18 23:12:12">昨天 23:12</time>\n    </section>\n    <section class="receive">\n        <p>Hello World</p>\n    </section>\n    <section class="send">\n        <p>Hello World 2</p>\n    </section>\n]]-->\n<!-- </article> -->'}),define("lib/face",[],function(){var e=["微笑","撇嘴","色","发呆","得意","流泪","害羞","闭嘴","睡","大哭","尴尬","发怒","调皮","呲牙","惊讶","难过","酷","冷汗","抓狂","吐","偷笑","愉快","白眼","傲慢","饥饿","困","惊恐","流汗","憨笑","悠闲","奋斗","咒骂","疑问","嘘","晕","疯了","衰","骷髅","敲打","再见","擦汗","抠鼻","鼓掌","糗大了","坏笑","左哼哼","右哼哼","哈欠","鄙视","委屈","快哭了","阴险","亲亲","吓","可怜","菜刀","西瓜","啤酒","篮球","乒乓","咖啡","饭","猪头","玫瑰","凋谢","嘴唇","爱心","心碎","蛋糕","闪电","炸弹","刀","足球","瓢虫","便便","月亮","太阳","礼物","拥抱","强","弱","握手","胜利","抱拳","勾引","拳头","差劲","爱你","NO","OK","爱情","飞吻","跳跳","发抖","怄火","转圈","磕头","回头","跳绳","投降","激动","乱舞","献吻","左太极","右太极"],t=["笑脸","开心","大笑","热情","眨眼","色","接吻","亲吻","脸红","露齿笑","满意","戏弄","吐舌","无语","得意","汗","失望","低落","呸","焦虑","担心","震惊","悔恨","眼泪","哭","破涕为笑","晕","恐惧","心烦","生气","睡觉","生病","恶魔","外星人","心","心碎","丘比特","闪烁","星星","叹号","问号","睡着","水滴","音乐","火","便便","强","弱","拳头","胜利","上","下","右","左","第一","强壮","吻","热恋","男孩","女孩","女士","男士","天使","骷髅","红唇","太阳","下雨","多云","雪人","月亮","闪电","海浪","猫","小狗","老鼠","仓鼠","兔子","狗","青蛙","老虎","考拉","熊","猪","牛","野猪","猴子","马","蛇","鸽子","鸡","企鹅","毛虫","章鱼","鱼","鲸鱼","海豚","玫瑰","花","棕榈树","仙人掌","礼盒","南瓜灯","鬼魂","圣诞老人","圣诞树","礼物","铃","庆祝","气球","CD","相机","录像机","电脑","电视","电话","解锁","锁","钥匙","成交","灯泡","邮箱","浴缸","钱","炸弹","手枪","药丸","橄榄球","篮球","足球","棒球","高尔夫","奖杯","入侵者","唱歌","吉他","比基尼","皇冠","雨伞","手提包","口红","戒指","钻石","咖啡","啤酒","干杯","鸡尾酒","汉堡","薯条","意面","寿司","面条","煎蛋","冰激凌","蛋糕","苹果","飞机","火箭","自行车","高铁","警告","旗","男人","女人","O","X","版权","注册商标","商标"],n={"微笑":"0","撇嘴":"1","色":"2","发呆":"3","得意":"4","流泪":"5","害羞":"6","闭嘴":"7","睡":"8","大哭":"9","尴尬":"10","发怒":"11","调皮":"12","呲牙":"13","惊讶":"14","难过":"15","酷":"16","冷汗":"17","抓狂":"18","吐":"19","偷笑":"20","可爱":"21","愉快":"21","白眼":"22","傲慢":"23","饥饿":"24","困":"25","惊恐":"26","流汗":"27","憨笑":"28","悠闲":"29","大兵":"29","奋斗":"30","咒骂":"31","疑问":"32","嘘":"33","晕":"34","疯了":"35","折磨":"35","衰":"36","骷髅":"37","敲打":"38","再见":"39","擦汗":"40","抠鼻":"41","鼓掌":"42","糗大了":"43","坏笑":"44","左哼哼":"45","右哼哼":"46","哈欠":"47","鄙视":"48","委屈":"49","快哭了":"50","阴险":"51","亲亲":"52","吓":"53","可怜":"54","菜刀":"55","西瓜":"56","啤酒":"57","篮球":"58","乒乓":"59","咖啡":"60","饭":"61","猪头":"62","玫瑰":"63","凋谢":"64","嘴唇":"65","示爱":"65","爱心":"66","心碎":"67","蛋糕":"68","闪电":"69","炸弹":"70","刀":"71","足球":"72","瓢虫":"73","便便":"74","月亮":"75","太阳":"76","礼物":"77","拥抱":"78","强":"79","弱":"80","握手":"81","胜利":"82","抱拳":"83","勾引":"84","拳头":"85","差劲":"86","爱你":"87",NO:"88",OK:"89","爱情":"90","飞吻":"91","跳跳":"92","发抖":"93","怄火":"94","转圈":"95","磕头":"96","回头":"97","跳绳":"98","投降":"99","激动":"100","乱舞":"101","献吻":"102","左太极":"103","右太极":"104",Smile:"0",Grimace:"1",Drool:"2",Scowl:"3",Chill:"4",CoolGuy:"4",Sob:"5",Shy:"6",Shutup:"7",Silent:"7",Sleep:"8",Cry:"9",Awkward:"10",Pout:"11",Angry:"11",Wink:"12",Tongue:"12",Grin:"13",Surprised:"14",Surprise:"14",Frown:"15",Cool:"16",Ruthless:"16",Tension:"17",Blush:"17",Scream:"18",Crazy:"18",Puke:"19",Chuckle:"20",Joyful:"21",Slight:"22",Smug:"23",Hungry:"24",Drowsy:"25",Panic:"26",Sweat:"27",Laugh:"28",Loafer:"29",Commando:"29",Strive:"30",Determined:"30",Scold:"31",Doubt:"32",Shocked:"32",Shhh:"33",Dizzy:"34",Tormented:"35",BadLuck:"36",Toasted:"36",Skull:"37",Hammer:"38",Wave:"39",Relief:"40",Speechless:"40",DigNose:"41",NosePick:"41",Clap:"42",Shame:"43",Trick:"44","Bah！L":"45","Bah！R":"46",Yawn:"47",Lookdown:"48","Pooh-pooh":"48",Wronged:"49",Shrunken:"49",Puling:"50",TearingUp:"50",Sly:"51",Kiss:"52","Uh-oh":"53",Wrath:"53",Whimper:"54",Cleaver:"55",Melon:"56",Watermelon:"56",Beer:"57",Basketball:"58",PingPong:"59",Coffee:"60",Rice:"61",Pig:"62",Rose:"63",Wilt:"64",Lip:"65",Lips:"65",Heart:"66",BrokenHeart:"67",Cake:"68",Lightning:"69",Bomb:"70",Dagger:"71",Soccer:"72",Ladybug:"73",Poop:"74",Moon:"75",Sun:"76",Gift:"77",Hug:"78",Strong:"79",ThumbsUp:"79",Weak:"80",ThumbsDown:"80",Shake:"81",Victory:"82",Peace:"82",Admire:"83",Fight:"83",Beckon:"84",Fist:"85",Pinky:"86",Love:"2",RockOn:"87",No:"88","Nuh-uh":"88",InLove:"90",Blowkiss:"91",Waddle:"92",Tremble:"93","Aaagh!":"94",Twirl:"95",Kotow:"96",Lookback:"97",Dramatic:"97",Jump:"98",JumpRope:"98","Give-in":"99",Surrender:"99",Hooray:"100",HeyHey:"101",Meditate:"101",Smooch:"102","TaiJi L":"103","TaiChi L":"103","TaiJi R":"104","TaiChi R":"104","發呆":"3","流淚":"5","閉嘴":"7","尷尬":"10","發怒":"11","調皮":"12","驚訝":"14","難過":"15","饑餓":"24","累":"25","驚恐":"26","悠閑":"29","奮鬥":"30","咒罵":"31","疑問":"32","噓":"33","暈":"34","瘋了":"35","骷髏頭":"37","再見":"39","摳鼻":"41","羞辱":"43","壞笑":"44","鄙視":"48","陰險":"51","親親":"52","嚇":"53","可憐":"54","籃球":"58","飯":"61","豬頭":"62","枯萎":"64","愛心":"66","閃電":"69","炸彈":"70","甲蟲":"73","太陽":"76","禮物":"77","擁抱":"78","強":"79","勝利":"82","拳頭":"85","差勁":"86","愛你":"88","愛情":"90","飛吻":"91","發抖":"93","噴火":"94","轉圈":"95","磕頭":"96","回頭":"97","跳繩":"98","激動":"100","亂舞":"101","獻吻":"102","左太極":"103","右太極":"104"},r={"<笑脸>":"1f604","<笑臉>":"1f604","<Laugh>":"1f604","<开心>":"1f60a","<開心>":"1f60a","<Happy>":"1f60a","<大笑>":"1f603","<Big Smile>":"1f603","<热情>":"263a","<熱情>":"263a","<Glowing>":"263a","<眨眼>":"1f609","<Wink>":"1f609","<色>":"1f60d","<Love>":"1f60d","<Drool>":"1f60d","<接吻>":"1f618","<Smooch>":"1f618","<亲吻>":"1f61a","<親吻>":"1f61a","<Kiss>":"1f61a","<脸红>":"1f633","<臉紅>":"1f633","<Blush>":"1f633","<露齿笑>":"1f63c","<露齒笑>":"1f63c","<Grin>":"1f63c","<满意>":"1f60c","<滿意>":"1f60c","<Satisfied>":"1f60c","<戏弄>":"1f61c","<戲弄>":"1f61c","<Tease>":"1f61c","<吐舌>":"1f445","<Tongue>":"1f445","<无语>":"1f612","<無語>":"1f612","<Speechless>":"1f612","<得意>":"1f60f","<Smirk>":"1f60f","<CoolGuy>":"1f60f","<汗>":"1f613","<Sweat>":"1f613","<失望>":"1f640","<Let Down>":"1f640","<低落>":"1f61e","<Low>":"1f61e","<呸>":"1f616","<Ugh>":"1f616","<焦虑>":"1f625","<焦慮>":"1f625","<Anxious>":"1f625","<担心>":"1f630","<擔心>":"1f630","<Worried>":"1f630","<震惊>":"1f628","<震驚>":"1f628","<Shocked>":"1f628","<悔恨>":"1f62b","<D’oh!>":"1f62b","<眼泪>":"1f622","<眼淚>":"1f622","<Tear>":"1f622","<哭>":"1f62d","<Cry>":"1f62d","<破涕为笑>":"1f602","<破涕為笑>":"1f602","<Lol>":"1f602","<晕>":"1f632","<Dead>":"1f632","<Dizzy>":"1f632","<恐惧>":"1f631","<恐懼>":"1f631","<Terror>":"1f631","<心烦>":"1f620","<心煩>":"1f620","<Upset>":"1f620","<生气>":"1f63e","<生氣>":"1f63e","<Angry>":"1f63e","<睡觉>":"1f62a","<睡覺>":"1f62a","<Zzz>":"1f62a","<生病>":"1f637","<Sick>":"1f637","<恶魔>":"1f47f","<惡魔>":"1f47f","<Demon>":"1f47f","<外星人>":"1f47d","<Alien>":"1f47d","<心>":"2764","<Heart>":"2764","<心碎>":"1f494","<Heartbroken>":"1f494","<BrokenHeart>":"1f494","<丘比特>":"1f498","<Cupid>":"1f498","<闪烁>":"2728","<閃爍>":"2728","<Twinkle>":"2728","<星星>":"1f31f","<Star>":"1f31f","<叹号>":"2755","<嘆號>":"2755","<!>":"2755","<问号>":"2754","<問號>":"2754","<?>":"2754","<睡着>":"1f4a4","<睡著>":"1f4a4","<Asleep>":"1f4a4","<水滴>":"1f4a6","<Drops>":"1f4a6","<音乐>":"1f3b5","<音樂>":"1f3b5","<Music>":"1f3b5","<火>":"1f525","<Fire>":"1f525","<便便>":"1f4a9","<Poop>":"1f4a9","<强>":"1f44d","<強>":"1f44d","<ThumbsUp>":"1f44d","<弱>":"1f44e","<ThumbsDown>":"1f44e","<拳头>":"1f44a","<拳頭>":"1f44a","<Punch>":"1f44a","<Fist>":"1f44a","<胜利>":"270c","<勝利>":"270c","<Peace>":"270c","<上>":"1f446","<Up>":"1f446","<下>":"1f447","<Down>":"1f447","<右>":"1f449","<Right>":"1f449","<左>":"1f448","<Left>":"1f448","<第一>":"261d","<#1>":"261d","<强壮>":"1f4aa","<強壯>":"1f4aa","<Strong>":"1f4aa","<吻>":"1f48f","<Kissing>":"1f48f","<热恋>":"1f491","<熱戀>":"1f491","<Couple>":"1f491","<男孩>":"1f466","<Boy>":"1f466","<女孩>":"1f467","<Girl>":"1f467","<女士>":"1f469","<Lady>":"1f469","<男士>":"1f468","<Man>":"1f468","<天使>":"1f47c","<Angel>":"1f47c","<骷髅>":"1f480","<骷髏>":"1f480","<Skull>":"1f480","<红唇>":"1f48b","<紅唇>":"1f48b","<Lips>":"1f48b","<太阳>":"2600","<太陽>":"2600","<Sun>":"2600","<下雨>":"2614","<Rain>":"2614","<多云>":"2601","<多雲>":"2601","<Cloud>":"2601","<雪人>":"26c4","<Snowman>":"26c4","<月亮>":"1f319","<Moon>":"1f319","<闪电>":"26a1","<閃電>":"26a1","<Lightning>":"26a1","<海浪>":"1f30a","<Waves>":"1f30a","<猫>":"1f431","<貓>":"1f431","<Cat>":"1f431","<小狗>":"1f429","<Doggy>":"1f429","<老鼠>":"1f42d","<Mouse>":"1f42d","<仓鼠>":"1f439","<倉鼠>":"1f439","<Hamster>":"1f439","<兔子>":"1f430","<Rabbit>":"1f430","<狗>":"1f43a","<Dog>":"1f43a","<青蛙>":"1f438","<Frog>":"1f438","<老虎>":"1f42f","<Tiger>":"1f42f","<考拉>":"1f428","<Koala>":"1f428","<熊>":"1f43b","<Bear>":"1f43b","<猪>":"1f437","<豬>":"1f437","<Pig>":"1f437","<牛>":"1f42e","<Cow>":"1f42e","<野猪>":"1f417","<野豬>":"1f417","<Boar>":"1f417","<猴子>":"1f435","<Monkey>":"1f435","<马>":"1f434","<馬>":"1f434","<Horse>":"1f434","<蛇>":"1f40d","<Snake>":"1f40d","<鸽子>":"1f426","<鴿子>":"1f426","<Pigeon>":"1f426","<鸡>":"1f414","<雞>":"1f414","<Chicken>":"1f414","<企鹅>":"1f427","<企鵝>":"1f427","<Penguin>":"1f427","<毛虫>":"1f41b","<毛蟲>":"1f41b","<Caterpillar>":"1f41b","<章鱼>":"1f419","<八爪魚>":"1f419","<Octopus>":"1f419","<鱼>":"1f420","<魚>":"1f420","<Fish>":"1f420","<鲸鱼>":"1f433","<鯨魚>":"1f433","<Whale>":"1f433","<海豚>":"1f42c","<Dolphin>":"1f42c","<玫瑰>":"1f339","<Rose>":"1f339","<花>":"1f33a","<Flower>":"1f33a","<棕榈树>":"1f334","<棕櫚樹>":"1f334","<Palm>":"1f334","<仙人掌>":"1f335","<Cactus>":"1f335","<礼盒>":"1f49d","<禮盒>":"1f49d","<Candy Box>":"1f49d","<南瓜灯>":"1f383","<南瓜燈>":"1f383","<Jack-o-lantern>":"1f383","<鬼魂>":"1f47b","<Ghost>":"1f47b","<圣诞老人>":"1f385","<聖誕老人>":"1f385","<Santa>":"1f385","<圣诞树>":"1f384","<聖誕樹>":"1f384","<Xmas Tree>":"1f384","<礼物>":"1f381","<禮物>":"1f381","<Gift>":"1f381","<铃>":"1f514","<鈴鐺>":"1f514","<Bell>":"1f514","<庆祝>":"1f389","<慶祝>":"1f389","<Party>":"1f389","<气球>":"1f388","<氣球>":"1f388","<Balloon>":"1f388","<CD>":"1f4bf","<相机>":"1f4f7","<相機>":"1f4f7","<Camera>":"1f4f7","<录像机>":"1f3a5","<錄影機>":"1f3a5","<Film Camera>":"1f3a5","<电脑>":"1f4bb","<電腦>":"1f4bb","<Computer>":"1f4bb","<电视>":"1f4fa","<電視>":"1f4fa","<TV>":"1f4fa","<电话>":"1f4de","<電話>":"1f4de","<Phone>":"1f4de","<解锁>":"1f513","<解鎖>":"1f513","<Unlocked>":"1f513","<锁>":"1f512","<鎖>":"1f512","<Locked>":"1f512","<钥匙>":"1f511","<鑰匙>":"1f511","<Key>":"1f511","<成交>":"1f528","<Judgement>":"1f528","<灯泡>":"1f4a1","<燈泡>":"1f4a1","<Light bulb>":"1f4a1","<邮箱>":"1f4eb","<郵箱>":"1f4eb","<Mail>":"1f4eb","<浴缸>":"1f6c0","<Wash>":"1f6c0","<钱>":"1f4b2","<錢>":"1f4b2","<Money>":"1f4b2","<炸弹>":"1f4a3","<炸彈>":"1f4a3","<Bomb>":"1f4a3","<手枪>":"1f52b","<手槍>":"1f52b","<Pistol>":"1f52b","<药丸>":"1f48a","<藥丸>":"1f48a","<Pill>":"1f48a","<橄榄球>":"1f3c8","<橄欖球>":"1f3c8","<Football>":"1f3c8","<篮球>":"1f3c0","<籃球>":"1f3c0","<Basketball>":"1f3c0","<足球>":"26bd","<Soccer Ball>":"26bd","<Soccer>":"26bd","<棒球>":"26be","<Baseball>":"26be","<高尔夫>":"26f3","<高爾夫>":"26f3","<Golf>":"26f3","<奖杯>":"1f3c6","<獎盃>":"1f3c6","<Trophy>":"1f3c6","<入侵者>":"1f47e","<Invader>":"1f47e","<唱歌>":"1f3a4","<Singing>":"1f3a4","<吉他>":"1f3b8","<Guitar>":"1f3b8","<比基尼>":"1f459","<Bikini>":"1f459","<皇冠>":"1f451","<Crown>":"1f451","<雨伞>":"1f302","<雨傘>":"1f302","<Umbrella>":"1f302","<手提包>":"1f45c","<Purse>":"1f45c","<口红>":"1f484","<Lipstick>":"1f484","<戒指>":"1f48d","<Ring>":"1f48d","<钻石>":"1f48e","<鑽石>":"1f48e","<Gem>":"1f48e","<咖啡>":"2615","<Coffee>":"2615","<啤酒>":"1f37a","<Beer>":"1f37a","<干杯>":"1f37b","<乾杯>":"1f37b","<Toast>":"1f37b","<鸡尾酒>":"1f377","<雞尾酒>":"1f377","<Martini>":"1f377","<汉堡>":"1f354","<漢堡>":"1f354","<Burger>":"1f354","<薯条>":"1f35f","<薯條>":"1f35f","<Fries>":"1f35f","<意面>":"1f35d","<意粉>":"1f35d","<Sphaghetti>":"1f35d","<寿司>":"1f363","<壽司>":"1f363","<Sushi>":"1f363","<面条>":"1f35c","<麵條>":"1f35c","<Noodles>":"1f35c","<煎蛋>":"1f373","<Eggs>":"1f373","<冰激凌>":"1f366","<雪糕>":"1f366","<Ice Cream>":"1f366","<蛋糕>":"1f382","<Cake>":"1f382","<苹果>":"1f34f","<蘋果>":"1f34f","<Apple>":"1f34f","<飞机>":"2708","<飛機>":"2708","<Plane>":"2708","<火箭>":"1f680","<Rocket ship>":"1f680","<自行车>":"1f6b2","<單車>":"1f6b2","<Bike>":"1f6b2","<高铁>":"1f684","<高鐵>":"1f684","<Bullet Train>":"1f684","<警告>":"26a0","<Warning>":"26a0","<旗>":"1f3c1","<Flag>":"1f3c1","<男人>":"1f6b9","<男>":"1f6b9","<Men>":"1f6b9","<女人>":"1f6ba","<女>":"1f6ba","<Women>":"1f6ba","<O>":"2b55","<X>":"274e","<版权>":"a9","<版權>":"a9","<Copyright>":"a9","<注册商标>":"ae","<注冊商標>":"ae","<Registered TM>":"ae","<商标>":"2122","<商標>":"2122","<Trademark>":"2122"},i={"/::)":"0","/::~":"1","/::B":"2","/::|":"3","/:8-)":"4","/::<":"5","/::$":"6","/::X":"7","/::Z":"8","/::'(":"9","/::-|":"10","/::@":"11","/::P":"12","/::D":"13","/::O":"14","/::(":"15","/::+":"16","/:--b":"17","/::Q":"18","/::T":"19","/:,@P":"20","/:,@-D":"21","/::d":"22","/:,@o":"23","/::g":"24","/:|-)":"25","/::!":"26","/::L":"27","/::>":"28","/::,@":"29","/:,@f":"30","/::-S":"31","/:?":"32","/:,@x":"33","/:,@@":"34","/::8":"35","/:,@!":"36","/:!!!":"37","/:xx":"38","/:bye":"39","/:wipe":"40","/:dig":"41","/:handclap":"42","/:&-(":"43","/:B-)":"44","/:<@":"45","/:@>":"46","/::-O":"47","/:>-|":"48","/:P-(":"49","/::'|":"50","/:X-)":"51","/::*":"52","/:@x":"53","/:8*":"54","/:pd":"55","/:<W>":"56","/:beer":"57","/:basketb":"58","/:oo":"59","/:coffee":"60","/:eat":"61","/:pig":"62","/:rose":"63","/:fade":"64","/:showlove":"65","/:heart":"66","/:break":"67","/:cake":"68","/:li":"69","/:bome":"70","/:kn":"71","/:footb":"72","/:ladybug":"73","/:shit":"74","/:moon":"75","/:sun":"76","/:gift":"77","/:hug":"78","/:strong":"79","/:weak":"80","/:share":"81","/:v":"82","/:@)":"83","/:jj":"84","/:@@":"85","/:bad":"86","/:lvu":"87","/:no":"88","/:ok":"89","/:love":"90","/:<L>":"91","/:jump":"92","/:shake":"93","/:<O>":"94","/:circle":"95","/:kotow":"96","/:turn":"97","/:skip":"98","/:oY":"99","/:#-0":"100","/:hiphot":"101","/:kiss":"102","/:<&":"103","/:&>":"104"},s={"1f604":"","1f60a":"","1f603":"","263a":"","1f609":"","1f60d":"","1f618":"","1f61a":"","1f633":"","1f63c":"","1f60c":"","1f61c":"","1f445":"","1f612":"","1f60f":"","1f613":"","1f640":"","1f61e":"","1f616":"","1f625":"","1f630":"","1f628":"","1f62b":"","1f622":"","1f62d":"","1f602":"","1f632":"","1f631":"","1f620":"","1f63e":"","1f62a":"","1f637":"","1f47f":"","1f47d":"",2764:"","1f494":"","1f498":"",2728:"","1f31f":"",2755:"",2754:"","1f4a4":"","1f4a6":"","1f3b5":"","1f525":"","1f4a9":"","1f44d":"","1f44e":"","1f44a":"","270c":"","1f446":"","1f447":"","1f449":"","1f448":"","261d":"","1f4aa":"","1f48f":"","1f491":"","1f466":"","1f467":"","1f469":"","1f468":"","1f47c":"","1f480":"","1f48b":"",2600:"",2614:"",2601:"","26c4":"","1f319":"","26a1":"","1f30a":"","1f431":"","1f429":"","1f42d":"","1f439":"","1f430":"","1f43a":"","1f438":"","1f42f":"","1f428":"","1f43b":"","1f437":"","1f42e":"","1f417":"","1f435":"","1f434":"","1f40d":"","1f426":"","1f414":"","1f427":"","1f41b":"","1f419":"","1f420":"","1f433":"","1f42c":"","1f339":"","1f33a":"","1f334":"","1f335":"","1f49d":"","1f383":"","1f47b":"","1f385":"","1f384":"","1f381":"","1f514":"","1f389":"","1f388":"","1f4bf":"","1f4f7":"","1f3a5":"","1f4bb":"","1f4fa":"","1f4de":"","1f513":"","1f512":"","1f511":"","1f528":"","1f4a1":"","1f4eb":"","1f6c0":"","1f4b2":"","1f4a3":"","1f52b":"","1f48a":"","1f3c8":"","1f3c0":"","26bd":"","26be":"","26f3":"","1f3c6":"","1f47e":"","1f3a4":"","1f3b8":"","1f459":"","1f451":"","1f302":"","1f45c":"","1f484":"","1f48d":"","1f48e":"",2615:"","1f37a":"","1f37b":"","1f377":"","1f354":"","1f35f":"","1f35d":"","1f363":"","1f35c":"","1f373":"","1f366":"","1f382":"","1f34f":"",2708:"","1f680":"","1f6b2":"","1f684":"","26a0":"","1f3c1":"","1f6b9":"","1f6ba":"","2b55":"","274e":"",a9:"",ae:"",2122:""};return{faceListMap:{qq:e,emoji:t},textToHtml:function(t){var s=t;for(var o in i)while(s.indexOf(o)!=-1)s=s.replace(o,function(e){return'<span class="qqemoji qqemoji'+i[e]+'"></span>'});return s=s.replace(/\[([^\]]*)\]/g,function(t,r){var i=e.indexOf(r);return i==-1?t:'<span class="qqemoji qqemoji'+n[r]+'"></span>'}),s=s.replace(/\<([^\>\s\\\/]*)\>/g,function(e,t){var n=r[t];return n?'<span class="emoji emoji'+n+'"></span>':e}),s}}}),define("view/im/messagebox/message/BaseText",["lib/class","lib/face"],function(e,t){return(new e).extend(function(e){var n=document.createElement("section");n.className=e.direction.toLowerCase(),n.id="message-"+e._id,this.toHtml=function(){return e.package&&e.package.undo?(n.className=n.className+" "+"gray",n.style.display="none","<div>[已撤销]</div>"):"<div>"+t.textToHtml(e.body)+"</div>"},this.appendTo=function(e){e.appendChild(n)},this.getContainer=function(){return n},n.innerHTML=this.toHtml();var r=n.querySelectorAll("img");for(var i=0;r&&i<r.length;i++)r[i].className+=" pure-img",r[i].style.cursor="pointer",r[i].addEventListener("click",function(){var e=new Image;e.src=this.src;var t=(window.screen.availHeight-30-e.height)/2,n=(window.screen.availWidth-10-e.width)/2;window.open(this.src,"newwindow","top="+t+", left="+n+", height="+e.height+", width="+e.width+", toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")})})}),define("view/im/messagebox/message/IM",["./BaseText"],function(e){return e}),define("view/im/messagebox/message/SMS",["./BaseText"],function(e){return e}),define("view/im/messagebox/message/WECHAT",["./BaseText"],function(e){return e}),define("view/im/messagebox/message/SYSTEM",["lib/class","lib/face"],function(e,t){return(new e).extend(function(e){var n=document.createElement("section");n.className="system",this.toHtml=function(){return"<span>"+t.textToHtml(e.body)+"</span>"},this.appendTo=function(t){if("SEND"!==e.direction)return;t.appendChild(n)},this.getContainer=function(){return n},n.innerHTML=this.toHtml()})}),define("view/im/messagebox/message/Message",["./IM","./SMS","./WECHAT","./SYSTEM"],function(e,t,n,r){var i={IM:e,SMS:t,WECHAT:n,SYSTEM:r};return{create:function(e){return i[e.type]?new i[e.type](e):null}}}),define("text!view/im/messageform/tools/Wiki.html",[],function(){return'<a class="wiki-hide">\n    <!--<i class="icon icon-close"></i>-->\n    <i style="color: #666; font-size: 20px" class="fa fa-times"></i>\n</a>\n<div class="wikiView">\n    <span class="title"><# echo $title; #></span>\n    <div class="message"><# echo $message; #></div>\n\n    <ul class="children">\n        <li>以下是关联问题</li>\n    </ul>\n</div>\n'}),define("view/im/messageform/tools/Wiki",["lib/class","text!./Wiki.html","lib/template","lib/ajax"],function(e,t,n,r){var i=(new e).extend(function(e,s){var o=document.querySelector("article"),u=document.querySelector("footer"),a=document.createElement("div");a.setAttribute("class","wiki-container"),a.style.background="#FAFAFA",a.style.position="absolute",a.style.top="3em",a.style.zIndex=999999,a.innerHTML=n(t,{title:e.title,message:e.message}),a.querySelector(".wikiView").style.height=o.offsetHeight+u.offsetHeight+"px",a.style.width=o.offsetWidth+"px",a.style.height=o.offsetHeight+u.offsetHeight+"px";var f=e.next_notes,l=a.querySelector(".children"),c=null;if(f.length)for(var h=0;h<f.length;h++)c=document.createElement("li"),c.innerHTML="<a>"+f[h].title+"</a>",c.setAttribute("data-wikiId",f[h]._id),c.addEventListener("click",function(){var e=document.querySelector(".wiki-container");r.jsonp("/api/knowledge/"+this.getAttribute("data-wikiId"),{},function(t){new i(t,s),document.body.removeChild(e)})}),l.appendChild(c);else l.style.display="none";var p=a.querySelector(".wiki-hide");p.addEventListener("click",function(e){document.body.removeChild(a)}),s&&(p.style.display="none"),document.body.appendChild(a)});return i}),define("view/im/messagebox/MessageBox",["lib/class","text!./MessageBox.html","./message/Message","lib/ajax","../messageform/tools/Wiki"],function(e,t,n,r,i){var s=document.createElement("article");s.innerHTML=t;var o=null,u=0,a=function(e){var t=new Date(e*1e3),n=Math.round((new Date).getTime()/1e3),r=Math.floor(n/86400)*86400+(new Date).getTimezoneOffset()*60;if(e>r)return t.toString().match(/\s(\d+\:\d+)/)[1];var i=Math.floor((e-r)/3600/24);return i==1?"昨天 "+t.toString().match(/\s(\d+\:\d+)/)[1]:i==2?"前天 "+t.toString().match(/\s(\d+\:\d+)/)[1]:t.getMonth()+1+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()};return(new e).extend(function(){var e=this;this.appendTo=function(e){e.appendChild(s)},this.insertTimeSection=function(e){var t=document.createElement("section");t.className="time";var n=document.createElement("time");n.setAttribute("datetime",(new Date(e*1e3)).toISOString()),n.innerHTML=a(e),t.appendChild(n),s.appendChild(t)},this.insertMessage=function(e){if(!e)return!1;var t=n.create(e);if(t){if(!!e.body.match('<span class="wiki-title">')){var o=t.getContainer().querySelector("a");o.setAttribute("href","javascript:void(0);"),o.setAttribute("onclick","javascript:void(0);"),o.addEventListener("click",function(){r.jsonp("/api/knowledge/"+this.getAttribute("data-wikiId"),{},function(e){new i(e)})})}e.created_at-u>600&&this.insertTimeSection(e.created_at),u=e.created_at,t.appendTo(s);var a=t.getContainer().querySelectorAll("img, voice, radio");for(var f=0;f<a.length;f++)a[f].addEventListener("load",function(){s.scrollTop=s.scrollHeight})}s.scrollTop=s.scrollHeight},this.setMessager=function(t){if(!o){o=t;var n=!1,r=[];o.addEventListener("message",function(t){var i=t.data.data;n?e.insertMessage(i):r.push(i)}),o.addEventListener("event",function(t){if(t.data.data.action=="tail"){n=!0;while(t.data.data.messages.length){var i=t.data.data.messages.shift();if(i.type==="SYSTEM"&&i.direction==="RECEIVE")continue;e.insertMessage(i)}if(r.length)while(i=r.shift())e.insertMessage(i)}}),setTimeout(function(){if(!n){n=!0;if(r.length)while(msg=r.shift())e.insertMessage(msg)}},2e3)}}})}),define("text!view/im/messageform/MessageForm.html",[],function(){return'<!-- <footer class="pure-form"> -->\n    <textarea class="pure-input-1" placeholder="有什么可以帮您?"></textarea>\n    <nav>\n        <a href="javascript:void(0)" title="发送" class="pure-button pull-right sendBtn" style="margin: .35em; line-height: 1.9em; padding: .1em 1em; font-size: .8em;"><span class="fa fa-send"></span>发送</a>\n    </nav>\n<!-- </footer> -->'}),function(){"use strict";function e(e){return typeof e=="function"||typeof e=="object"&&e!==null}function t(e){return typeof e=="function"}function n(e){return typeof e=="object"&&e!==null}function f(e){u=e}function l(e){a=e}function m(){return function(){process.nextTick(S)}}function g(){return function(){o(S)}}function y(){var e=0,t=new p(S),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function b(){var e=new MessageChannel;return e.port1.onmessage=S,function(){e.port2.postMessage(0)}}function w(){return function(){setTimeout(S,1)}}function S(){for(var e=0;e<s;e+=2){var t=E[e],n=E[e+1];t(n),E[e]=undefined,E[e+1]=undefined}s=0}function x(){try{var e=require,t=e("vertx");return o=t.runOnLoop||t.runOnContext,g()}catch(n){return w()}}function N(e,t){var n=this,r=new this.constructor(O);r[A]===undefined&&tt(r);var i=n._state;if(i){var s=arguments[i-1];a(function(){G(i,r,s,n._result)})}else V(n,r,e,t);return r}function k(e){var t=this;if(e&&typeof e=="object"&&e.constructor===t)return e;var n=new t(O);return U(n,e),n}function O(){}function H(){return new TypeError("You cannot resolve a promise with itself")}function B(){return new TypeError("A promises callback cannot return that same promise.")}function j(e){try{return e.then}catch(t){return P.error=t,P}}function F(e,t,n,r){try{e.call(t,n,r)}catch(i){return i}}function I(e,t,n){a(function(e){var r=!1,i=F(n,t,function(n){if(r)return;r=!0,t!==n?U(e,n):W(e,n)},function(t){if(r)return;r=!0,X(e,t)},"Settle: "+(e._label||" unknown promise"));!r&&i&&(r=!0,X(e,i))},e)}function q(e,t){t._state===_?W(e,t._result):t._state===D?X(e,t._result):V(t,undefined,function(t){U(e,t)},function(t){X(e,t)})}function R(e,n,r){n.constructor===e.constructor&&r===C&&constructor.resolve===L?q(e,n):r===P?X(e,P.error):r===undefined?W(e,n):t(r)?I(e,n,r):W(e,n)}function U(t,n){t===n?X(t,H()):e(n)?R(t,n,j(n)):W(t,n)}function z(e){e._onerror&&e._onerror(e._result),$(e)}function W(e,t){if(e._state!==M)return;e._result=t,e._state=_,e._subscribers.length!==0&&a($,e)}function X(e,t){if(e._state!==M)return;e._state=D,e._result=t,a(z,e)}function V(e,t,n,r){var i=e._subscribers,s=i.length;e._onerror=null,i[s]=t,i[s+_]=n,i[s+D]=r,s===0&&e._state&&a($,e)}function $(e){var t=e._subscribers,n=e._state;if(t.length===0)return;var r,i,s=e._result;for(var o=0;o<t.length;o+=3)r=t[o],i=t[o+n],r?G(n,r,i,s):i(s);e._subscribers.length=0}function J(){this.error=null}function Q(e,t){try{return e(t)}catch(n){return K.error=n,K}}function G(e,n,r,i){var s=t(r),o,u,a,f;if(s){o=Q(r,i),o===K?(f=!0,u=o.error,o=null):a=!0;if(n===o){X(n,B());return}}else o=i,a=!0;n._state===M&&(s&&a?U(n,o):f?X(n,u):e===_?W(n,o):e===D&&X(n,o))}function Y(e,t){try{t(function(n){U(e,n)},function(n){X(e,n)})}catch(n){X(e,n)}}function et(){return Z++}function tt(e){e[A]=Z++,e._state=undefined,e._result=undefined,e._subscribers=[]}function nt(e){return(new ht(this,e)).promise}function it(e){var t=this;return i(e)?new t(function(n,r){var i=e.length;for(var s=0;s<i;s++)t.resolve(e[s]).then(n,r)}):new t(function(e,t){t(new TypeError("You must pass an array to race."))})}function ot(e){var t=this,n=new t(O);return X(n,e),n}function at(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ft(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function ct(e){this[A]=et(),this._result=this._state=undefined,this._subscribers=[],O!==e&&(typeof e!="function"&&at(),this instanceof ct?Y(this,e):ft())}function pt(e,t){this._instanceConstructor=e,this.promise=new e(O),this.promise[A]||tt(this.promise),i(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),this.length===0?W(this.promise,this._result):(this.length=this.length||0,this._enumerate(),this._remaining===0&&W(this.promise,this._result))):X(this.promise,dt())}function dt(){return new Error("Array Methods must be provided an Array")}function vt(){var e;if(typeof global!="undefined")e=global;else if(typeof self!="undefined")e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n&&Object.prototype.toString.call(n.resolve())==="[object Promise]"&&!n.cast)return;e.Promise=lt}var r;Array.isArray?r=Array.isArray:r=function(e){return Object.prototype.toString.call(e)==="[object Array]"};var i=r,s=0,o,u,a=function(t,n){E[s]=t,E[s+1]=n,s+=2,s===2&&(u?u(S):T())},c=typeof window!="undefined"?window:undefined,h=c||{},p=h.MutationObserver||h.WebKitMutationObserver,d=typeof self=="undefined"&&typeof process!="undefined"&&{}.toString.call(process)==="[object process]",v=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined",E=new Array(1e3),T;d?T=m():p?T=y():v?T=b():c===undefined&&typeof require=="function"?T=x():T=w();var C=N,L=k,A=Math.random().toString(36).substring(16),M=void 0,_=1,D=2,P=new J,K=new J,Z=0,rt=nt,st=it,ut=ot,lt=ct;ct.all=rt,ct.race=st,ct.resolve=L,ct.reject=ut,ct._setScheduler=f,ct._setAsap=l,ct._asap=a,ct.prototype={constructor:ct,then:C,"catch":function(e){return this.then(null,e)}};var ht=pt;pt.prototype._enumerate=function(){var e=this.length,t=this._input;for(var n=0;this._state===M&&n<e;n++)this._eachEntry(t[n],n)},pt.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,r=n.resolve;if(r===L){var i=j(e);if(i===C&&e._state!==M)this._settledAt(e._state,t,e._result);else if(typeof i!="function")this._remaining--,this._result[t]=e;else if(n===lt){var s=new n(O);R(s,e,i),this._willSettleAt(s,t)}else this._willSettleAt(new n(function(t){t(e)}),t)}else this._willSettleAt(r(e),t)},pt.prototype._settledAt=function(e,t,n){var r=this.promise;r._state===M&&(this._remaining--,e===D?X(r,n):this._result[t]=n),this._remaining===0&&W(r,this._result)},pt.prototype._willSettleAt=function(e,t){var n=this;V(e,undefined,function(e){n._settledAt(_,t,e)},function(e){n._settledAt(D,t,e)})};var mt=vt,gt={Promise:lt,polyfill:mt};typeof define=="function"&&define.amd?define("promise",[],function(){return gt}):typeof module!="undefined"&&module.exports?module.exports=gt:typeof this!="undefined"&&(this.ES6Promise=gt),mt()}.call(this),function(e){if(typeof exports=="object"&&typeof module!="undefined")module.exports=e();else if(typeof define=="function"&&define.amd)define("lib/html2canvas",["promise"],e);else{var t;typeof window!="undefined"?t=window:typeof global!="undefined"?t=global:typeof self!="undefined"?t=self:t=this,t.html2canvas=e()}}(function(){var e,t,n,r={};return function i(e,t,n){function r(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=t[o]={exports:{}};e[o][0].call(l.exports,function(t){var n=e[o][1][t];return r(n?n:t)},l,l.exports,i,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,n,r){(function(t){(function(i){function C(e){throw RangeError(E[e])}function k(e,t){var n=e.length,r=[];while(n--)r[n]=t(e[n]);return r}function L(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(w,".");var i=e.split("."),s=k(i,t).join(".");return r+s}function A(e){var t=[],n=0,r=e.length,i,s;while(n<r)i=e.charCodeAt(n++),i>=55296&&i<=56319&&n<r?(s=e.charCodeAt(n++),(s&64512)==56320?t.push(((i&1023)<<10)+(s&1023)+65536):(t.push(i),n--)):t.push(i);return t}function O(e){return k(e,function(e){var t="";return e>65535&&(e-=65536,t+=T(e>>>10&1023|55296),e=56320|e&1023),t+=T(e),t}).join("")}function M(e){return e-48<10?e-22:e-65<26?e-65:e-97<26?e-97:l}function _(e,t){return e+22+75*(e<26)-((t!=0)<<5)}function D(e,t,n){var r=0;e=n?x(e/d):e>>1,e+=x(e/t);for(;e>S*h>>1;r+=l)e=x(e/S);return x(r+(S+1)*e/(e+p))}function P(e){var t=[],n=e.length,r,i=0,s=m,o=v,u,a,p,d,y,b,w,E,S;u=e.lastIndexOf(g),u<0&&(u=0);for(a=0;a<u;++a)e.charCodeAt(a)>=128&&C("not-basic"),t.push(e.charCodeAt(a));for(p=u>0?u+1:0;p<n;){for(d=i,y=1,b=l;;b+=l){p>=n&&C("invalid-input"),w=M(e.charCodeAt(p++)),(w>=l||w>x((f-i)/y))&&C("overflow"),i+=w*y,E=b<=o?c:b>=o+h?h:b-o;if(w<E)break;S=l-E,y>x(f/S)&&C("overflow"),y*=S}r=t.length+1,o=D(i-d,r,d==0),x(i/r)>f-s&&C("overflow"),s+=x(i/r),i%=r,t.splice(i++,0,s)}return O(t)}function H(e){var t,n,r,i,s,o,u,a,p,d,y,b=[],w,E,S,N;e=A(e),w=e.length,t=m,n=0,s=v;for(o=0;o<w;++o)y=e[o],y<128&&b.push(T(y));r=i=b.length,i&&b.push(g);while(r<w){for(u=f,o=0;o<w;++o)y=e[o],y>=t&&y<u&&(u=y);E=r+1,u-t>x((f-n)/E)&&C("overflow"),n+=(u-t)*E,t=u;for(o=0;o<w;++o){y=e[o],y<t&&++n>f&&C("overflow");if(y==t){for(a=n,p=l;;p+=l){d=p<=s?c:p>=s+h?h:p-s;if(a<d)break;N=a-d,S=l-d,b.push(T(_(d+N%S,0))),a=x(N/S)}b.push(T(_(a,0))),s=D(n,E,r==i),n=0,++r}}++n,++t}return b.join("")}function B(e){return L(e,function(e){return y.test(e)?P(e.slice(4).toLowerCase()):e})}function j(e){return L(e,function(e){return b.test(e)?"xn--"+H(e):e})}var s=typeof r=="object"&&r&&!r.nodeType&&r,o=typeof n=="object"&&n&&!n.nodeType&&n,u=typeof t=="object"&&t;if(u.global===u||u.window===u||u.self===u)i=u;var a,f=2147483647,l=36,c=1,h=26,p=38,d=700,v=72,m=128,g="-",y=/^xn--/,b=/[^\x20-\x7E]/,w=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},S=l-c,x=Math.floor,T=String.fromCharCode,N;a={version:"1.3.2",ucs2:{decode:A,encode:O},decode:P,encode:H,toASCII:j,toUnicode:B};if(typeof e=="function"&&typeof e.amd=="object"&&e.amd)e("punycode",function(){return a});else if(s&&o)if(n.exports==s)o.exports=a;else for(N in a)a.hasOwnProperty(N)&&(s[N]=a[N]);else i.punycode=a})(this)}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(e,t,n){function i(e,t,n){e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)}function s(e,t){try{t&&(t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e.getContext("2d").getImageData(0,0,e.width,e.height),0,0))}catch(n){r("Unable to copy canvas content from",e,n)}}function o(e,t){var n=e.nodeType===3?document.createTextNode(e.nodeValue):e.cloneNode(!1),r=e.firstChild;while(r)(t===!0||r.nodeType!==1||r.nodeName!=="SCRIPT")&&n.appendChild(o(r,t)),r=r.nextSibling;if(e.nodeType===1){n._scrollTop=e.scrollTop,n._scrollLeft=e.scrollLeft;if(e.nodeName==="CANVAS")s(e,n);else if(e.nodeName==="TEXTAREA"||e.nodeName==="SELECT")n.value=e.value}return n}function u(e){if(e.nodeType===1){e.scrollTop=e._scrollTop,e.scrollLeft=e._scrollLeft;var t=e.firstChild;while(t)u(t),t=t.nextSibling}}var r=e("./log");t.exports=function(e,t,n,r,s,a,f){var l=o(e.documentElement,s.javascriptEnabled),c=l.querySelector(".__usingnetClassNameForCustom");c&&c.parentElement.removeChild(c);var h=t.createElement("iframe");return h.className="html2canvas-container",h.style.visibility="hidden",h.style.position="fixed",h.style.left="-10000px",h.style.top="0px",h.style.border="0",h.width=n,h.height=r,h.scrolling="no",t.body.appendChild(h),new Promise(function(t){var n=h.contentWindow.document;h.contentWindow.onload=h.onload=function(){var e=setInterval(function(){n.body.childNodes.length>0&&(u(n.documentElement),clearInterval(e),s.type==="view"&&(h.contentWindow.scrollTo(a,f),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(h.contentWindow.scrollY!==f||h.contentWindow.scrollX!==a)&&(n.documentElement.style.top=-f+"px",n.documentElement.style.left=-a+"px",n.documentElement.style.position="absolute")),t(h))},50)},n.open(),n.write("<!DOCTYPE html><html></html>"),i(e,a,f),n.replaceChild(n.adoptNode(l),n.documentElement),n.close()})}},{"./log":13}],3:[function(e,t,n){function r(e){this.r=0,this.g=0,this.b=0,this.a=null;var t=this.fromArray(e)||this.namedColor(e)||this.rgb(e)||this.rgba(e)||this.hex6(e)||this.hex3(e)}r.prototype.darken=function(e){var t=1-e;return new r([Math.round(this.r*t),Math.round(this.g*t),Math.round(this.b*t),this.a])},r.prototype.isTransparent=function(){return this.a===0},r.prototype.isBlack=function(){return this.r===0&&this.g===0&&this.b===0},r.prototype.fromArray=function(e){return Array.isArray(e)&&(this.r=Math.min(e[0],255),this.g=Math.min(e[1],255),this.b=Math.min(e[2],255),e.length>3&&(this.a=e[3])),Array.isArray(e)};var i=/^#([a-f0-9]{3})$/i;r.prototype.hex3=function(e){var t=null;return(t=e.match(i))!==null&&(this.r=parseInt(t[1][0]+t[1][0],16),this.g=parseInt(t[1][1]+t[1][1],16),this.b=parseInt(t[1][2]+t[1][2],16)),t!==null};var s=/^#([a-f0-9]{6})$/i;r.prototype.hex6=function(e){var t=null;return(t=e.match(s))!==null&&(this.r=parseInt(t[1].substring(0,2),16),this.g=parseInt(t[1].substring(2,4),16),this.b=parseInt(t[1].substring(4,6),16)),t!==null};var o=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/;r.prototype.rgb=function(e){var t=null;return(t=e.match(o))!==null&&(this.r=Number(t[1]),this.g=Number(t[2]),this.b=Number(t[3])),t!==null};var u=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?\.?\d+)\s*\)$/;r.prototype.rgba=function(e){var t=null;return(t=e.match(u))!==null&&(this.r=Number(t[1]),this.g=Number(t[2]),this.b=Number(t[3]),this.a=Number(t[4])),t!==null},r.prototype.toString=function(){return this.a!==null&&this.a!==1?"rgba("+[this.r,this.g,this.b,this.a].join(",")+")":"rgb("+[this.r,this.g,this.b].join(",")+")"},r.prototype.namedColor=function(e){e=e.toLowerCase();var t=a[e];if(t)this.r=t[0],this.g=t[1],this.b=t[2];else if(e==="transparent")return this.r=this.g=this.b=this.a=0,!0;return!!t},r.prototype.isColor=!0;var a={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};t.exports=r},{}],4:[function(t,n,i){function y(e,t,n,r,i){return h(e,e,n,r,t,e.defaultView.pageXOffset,e.defaultView.pageYOffset).then(function(s){l("Document cloned");var o=v+i,u="["+o+"='"+i+"']";e.querySelector(u).removeAttribute(o);var a=s.contentWindow,f=a.document.querySelector(u),c=typeof t.onclone=="function"?Promise.resolve(t.onclone(a.document)):Promise.resolve(!0);return c.then(function(){return b(f,s,t,n,r)})})}function b(e,t,n,r,i){var o=t.contentWindow,f=new s(o.document),c=new u(n,f),h=d(e),p=n.type==="view"?r:S(o.document),v=n.type==="view"?i:x(o.document),m=new n.renderer(p,v,c,n,document),g=new a(e,m,f,c,n);return g.ready.then(function(){l("Finished rendering");var r;return n.type==="view"?r=E(m.canvas,{width:m.canvas.width,height:m.canvas.height,top:0,left:0,x:0,y:0}):e===o.document.body||e===o.document.documentElement||n.canvas!=null?r=m.canvas:r=E(m.canvas,{width:n.width!=null?n.width:h.width,height:n.height!=null?n.height:h.height,top:h.top,left:h.left,x:o.pageXOffset,y:o.pageYOffset}),w(t,n),r})}function w(e,t){t.removeContainer&&(e.parentNode.removeChild(e),l("Cleaned up container"))}function E(e,t){var n=document.createElement("canvas"),r=Math.min(e.width-1,Math.max(0,t.left)),i=Math.min(e.width,Math.max(1,t.left+t.width)),s=Math.min(e.height-1,Math.max(0,t.top)),o=Math.min(e.height,Math.max(1,t.top+t.height));return n.width=t.width,n.height=t.height,l("Cropping canvas at:","left:",t.left,"top:",t.top,"width:",i-r,"height:",o-s),l("Resulting crop with width",t.width,"and height",t.height," with x",r,"and y",s),n.getContext("2d").drawImage(e,r,s,i-r,o-s,t.x,t.y,i-r,o-s),n}function S(e){return Math.max(Math.max(e.body.scrollWidth,e.documentElement.scrollWidth),Math.max(e.body.offsetWidth,e.documentElement.offsetWidth),Math.max(e.body.clientWidth,e.documentElement.clientWidth))}function x(e){return Math.max(Math.max(e.body.scrollHeight,e.documentElement.scrollHeight),Math.max(e.body.offsetHeight,e.documentElement.offsetHeight),Math.max(e.body.clientHeight,e.documentElement.clientHeight))}function T(e){var t=document.createElement("a");return t.href=e,t.href=t.href,t}var s=t("./support"),o=t("./renderers/canvas"),u=t("./imageloader"),a=t("./nodeparser"),f=t("./nodecontainer"),l=t("./log"),c=t("./utils"),h=t("./clone"),p=t("./proxy").loadUrlDocument,d=c.getBounds,v="data-html2canvas-node",m=0;r.html2canvas=function(e,t){var n=m++;t=t||{},t.logging&&(r.html2canvas.logging=!0,r.html2canvas.start=Date.now()),t.async=typeof t.async=="undefined"?!0:t.async,t.allowTaint=typeof t.allowTaint=="undefined"?!1:t.allowTaint,t.removeContainer=typeof t.removeContainer=="undefined"?!0:t.removeContainer,t.javascriptEnabled=typeof t.javascriptEnabled=="undefined"?!1:t.javascriptEnabled,t.imageTimeout=typeof t.imageTimeout=="undefined"?1e4:t.imageTimeout,t.renderer=typeof t.renderer=="function"?t.renderer:o,t.strict=!!t.strict;if(typeof e=="string"){if(typeof t.proxy!="string")return Promise.reject("Proxy must be used when rendering url");var i=t.width!=null?t.width:window.innerWidth,s=t.height!=null?t.height:window.innerHeight;return p(T(e),t.proxy,document,i,s,t).then(function(e){return b(e.contentWindow.document.documentElement,e,t,i,s)})}var u=(e===undefined?[document.documentElement]:e.length?e:[e])[0];return u.setAttribute(v+n,n),y(u.ownerDocument,t,u.ownerDocument.defaultView.innerWidth,u.ownerDocument.defaultView.innerHeight,n).then(function(e){return typeof t.onrendered=="function"&&(l("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),t.onrendered(e)),e})},r.html2canvas.CanvasRenderer=o,r.html2canvas.NodeContainer=f,r.html2canvas.log=l,r.html2canvas.utils=c;var g=typeof document=="undefined"||typeof Object.create!="function"||typeof document.createElement("canvas").getContext!="function"?function(){return Promise.reject("No canvas support")}:r.html2canvas;n.exports=g,typeof e=="function"&&e.amd&&e("html2canvas",[],function(){return g})},{"./clone":2,"./imageloader":11,"./log":13,"./nodecontainer":14,"./nodeparser":15,"./proxy":16,"./renderers/canvas":20,"./support":22,"./utils":26}],5:[function(e,t,n){function s(e){this.src=e,r("DummyImageContainer for",e);if(!this.promise||!this.image){r("Initiating DummyImageContainer"),s.prototype.image=new Image;var t=this.image;s.prototype.promise=new Promise(function(e,n){t.onload=e,t.onerror=n,t.src=i(),t.complete===!0&&e(t)})}}var r=e("./log"),i=e("./utils").smallImage;t.exports=s},{"./log":13,"./utils":26}],6:[function(e,t,n){function i(e,t){var n=document.createElement("div"),i=document.createElement("img"),s=document.createElement("span"),o="Hidden Text",u,a;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin=0,n.style.padding=0,document.body.appendChild(n),i.src=r(),i.width=1,i.height=1,i.style.margin=0,i.style.padding=0,i.style.verticalAlign="baseline",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin=0,s.style.padding=0,s.appendChild(document.createTextNode(o)),n.appendChild(s),n.appendChild(i),u=i.offsetTop-s.offsetTop+1,n.removeChild(s),n.appendChild(document.createTextNode(o)),n.style.lineHeight="normal",i.style.verticalAlign="super",a=i.offsetTop-n.offsetTop+1,document.body.removeChild(n),this.baseline=u,this.lineWidth=1,this.middle=a}var r=e("./utils").smallImage;t.exports=i},{"./utils":26}],7:[function(e,t,n){function i(){this.data={}}var r=e("./font");i.prototype.getMetrics=function(e,t){return this.data[e+"-"+t]===undefined&&(this.data[e+"-"+t]=new r(e,t)),this.data[e+"-"+t]},t.exports=i},{"./font":6}],8:[function(e,t,n){function o(t,n,r){this.image=null,this.src=t;var s=this,o=i(t);this.promise=(n?new Promise(function(e){t.contentWindow.document.URL==="about:blank"||t.contentWindow.document.documentElement==null?t.contentWindow.onload=t.onload=function(){e(t)}:e(t)}):this.proxyLoad(r.proxy,o,r)).then(function(t){var n=e("./core");return n(t.contentWindow.document.documentElement,{type:"view",width:t.width,height:t.height,proxy:r.proxy,javascriptEnabled:r.javascriptEnabled,removeContainer:r.removeContainer,allowTaint:r.allowTaint,imageTimeout:r.imageTimeout/2})}).then(function(e){return s.image=e})}var r=e("./utils"),i=r.getBounds,s=e("./proxy").loadUrlDocument;o.prototype.proxyLoad=function(e,t,n){var r=this.src;return s(r.src,e,r.ownerDocument,t.width,t.height,n)},t.exports=o},{"./core":4,"./proxy":16,"./utils":26}],9:[function(e,t,n){function r(e){this.src=e.value,this.colorStops=[],this.type=null,this.x0=.5,this.y0=.5,this.x1=.5,this.y1=.5,this.promise=Promise.resolve(!0)}r.TYPES={LINEAR:1,RADIAL:2},r.REGEXP_COLORSTOP=/^\s*(rgba?\(\s*\d{1,3},\s*\d{1,3},\s*\d{1,3}(?:,\s*[0-9\.]+)?\s*\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\s+(\d{1,3}(?:\.\d+)?)(%|px)?)?(?:\s|$)/i,t.exports=r},{}],10:[function(e,t,n){function r(e,t){this.src=e,this.image=new Image;var n=this;this.tainted=null,this.promise=new Promise(function(r,i){n.image.onload=r,n.image.onerror=i,t&&(n.image.crossOrigin="anonymous"),n.image.src=e,n.image.complete===!0&&r(n.image)})}t.exports=r},{}],11:[function(e,t,n){function p(e,t){this.link=null,this.options=e,this.support=t,this.origin=this.getOrigin(window.location.href)}var r=e("./log"),i=e("./imagecontainer"),s=e("./dummyimagecontainer"),o=e("./proxyimagecontainer"),u=e("./framecontainer"),a=e("./svgcontainer"),f=e("./svgnodecontainer"),l=e("./lineargradientcontainer"),c=e("./webkitgradientcontainer"),h=e("./utils").bind;p.prototype.findImages=function(e){var t=[];return e.reduce(function(e,t){switch(t.node.nodeName){case"IMG":return e.concat([{args:[t.node.src],method:"url"}]);case"svg":case"IFRAME":return e.concat([{args:[t.node],method:t.node.nodeName}])}return e},[]).forEach(this.addImage(t,this.loadImage),this),t},p.prototype.findBackgroundImage=function(e,t){return t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e,this.loadImage),this),e},p.prototype.addImage=function(e,t){return function(n){n.args.forEach(function(i){this.imageExists(e,i)||(e.splice(0,0,t.call(this,n)),r("Added image #"+e.length,typeof i=="string"?i.substring(0,100):i))},this)}},p.prototype.hasImageBackground=function(e){return e.method!=="none"},p.prototype.loadImage=function(e){if(e.method==="url"){var t=e.args[0];return this.isSVG(t)&&!this.support.svg&&!this.options.allowTaint?new a(t):t.match(/data:image\/.*;base64,/i)?new i(t.replace(/url\(['"]{0,}|['"]{0,}\)$/ig,""),!1):this.isSameOrigin(t)||this.options.allowTaint===!0||this.isSVG(t)?new i(t,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new i(t,!0):this.options.proxy?new o(t,this.options.proxy):new s(t)}return e.method==="linear-gradient"?new l(e):e.method==="gradient"?new c(e):e.method==="svg"?new f(e.args[0],this.support.svg):e.method==="IFRAME"?new u(e.args[0],this.isSameOrigin(e.args[0].src),this.options):new s(e)},p.prototype.isSVG=function(e){return e.substring(e.length-3).toLowerCase()==="svg"||a.prototype.isInline(e)},p.prototype.imageExists=function(e,t){return e.some(function(e){return e.src===t})},p.prototype.isSameOrigin=function(e){return this.getOrigin(e)===this.origin},p.prototype.getOrigin=function(e){var t=this.link||(this.link=document.createElement("a"));return t.href=e,t.href=t.href,t.protocol+t.hostname+t.port},p.prototype.getPromise=function(e){return this.timeout(e,this.options.imageTimeout)["catch"](function(){var t=new s(e.src);return t.promise.then(function(t){e.image=t})})},p.prototype.get=function(e){var t=null;return this.images.some(function(n){return(t=n).src===e})?t:null},p.prototype.fetch=function(e){return this.images=e.reduce(h(this.findBackgroundImage,this),this.findImages(e)),this.images.forEach(function(e,t){e.promise.then(function(){r("Succesfully loaded image #"+(t+1),e)},function(n){r("Failed loading image #"+(t+1),e,n)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),r("Finished searching images"),this},p.prototype.timeout=function(e,t){var n,i=Promise.race([e.promise,new Promise(function(i,s){n=setTimeout(function(){r("Timed out loading image",e),s(e)},t)})]).then(function(e){return clearTimeout(n),e});return i["catch"](function(){clearTimeout(n)}),i},t.exports=p},{"./dummyimagecontainer":5,"./framecontainer":8,"./imagecontainer":10,"./lineargradientcontainer":12,"./log":13,"./proxyimagecontainer":17,"./svgcontainer":23,"./svgnodecontainer":24,"./utils":26,"./webkitgradientcontainer":27}],12:[function(e,t,n){function s(e){r.apply(this,arguments),this.type=r.TYPES.LINEAR;var t=s.REGEXP_DIRECTION.test(e.args[0])||!r.REGEXP_COLORSTOP.test(e.args[0]);t?e.args[0].split(/\s+/).reverse().forEach(function(e,t){switch(e){case"left":this.x0=0,this.x1=1;break;case"top":this.y0=0,this.y1=1;break;case"right":this.x0=1,this.x1=0;break;case"bottom":this.y0=1,this.y1=0;break;case"to":var n=this.y0,r=this.x0;this.y0=this.y1,this.x0=this.x1,this.x1=r,this.y1=n;break;case"center":break;default:var i=parseFloat(e,10)*.01;if(isNaN(i))break;t===0?(this.y0=i,this.y1=1-this.y0):(this.x0=i,this.x1=1-this.x0)}},this):(this.y0=0,this.y1=1),this.colorStops=e.args.slice(t?1:0).map(function(e){var t=e.match(r.REGEXP_COLORSTOP),n=+t[2],s=n===0?"%":t[3];return{color:new i(t[1]),stop:s==="%"?n/100:null}}),this.colorStops[0].stop===null&&(this.colorStops[0].stop=0),this.colorStops[this.colorStops.length-1].stop===null&&(this.colorStops[this.colorStops.length-1].stop=1),this.colorStops.forEach(function(e,t){e.stop===null&&this.colorStops.slice(t).some(function(n,r){return n.stop!==null?(e.stop=(n.stop-this.colorStops[t-1].stop)/(r+1)+this.colorStops[t-1].stop,!0):!1},this)},this)}var r=e("./gradientcontainer"),i=e("./color");s.prototype=Object.create(r.prototype),s.REGEXP_DIRECTION=/^\s*(?:to|left|right|top|bottom|center|\d{1,3}(?:\.\d+)?%?)(?:\s|$)/i,t.exports=s},{"./color":3,"./gradientcontainer":9}],13:[function(e,t,n){t.exports=function(){r.html2canvas.logging&&window.console&&window.console.log&&Function.prototype.bind.call(window.console.log,window.console).apply(window.console,[Date.now()-r.html2canvas.start+"ms","html2canvas:"].concat([].slice.call(arguments,0)))}},{}],14:[function(e,t,n){function a(e,t){this.node=e,this.parent=t,this.stack=null,this.bounds=null,this.borders=null,this.clip=[],this.backgroundClip=[],this.offsetBounds=null,this.visible=null,this.computedStyles=null,this.colors={},this.styles={},this.backgroundImages=null,this.transformData=null,this.transformMatrix=null,this.isPseudoElement=!1,this.opacity=null}function f(e){var t=e.options[e.selectedIndex||0];return t?t.text||"":""}function l(e){if(e&&e[1]==="matrix")return e[2].split(",").map(function(e){return parseFloat(e.trim())});if(e&&e[1]==="matrix3d"){var t=e[2].split(",").map(function(e){return parseFloat(e.trim())});return[t[0],t[1],t[4],t[5],t[12],t[13]]}}function c(e){return e.toString().indexOf("%")!==-1}function h(e){return e.replace("px","")}function p(e){return parseFloat(e)}var r=e("./color"),i=e("./utils"),s=i.getBounds,o=i.parseBackgrounds,u=i.offsetBounds;a.prototype.cloneTo=function(e){e.visible=this.visible,e.borders=this.borders,e.bounds=this.bounds,e.clip=this.clip,e.backgroundClip=this.backgroundClip,e.computedStyles=this.computedStyles,e.styles=this.styles,e.backgroundImages=this.backgroundImages,e.opacity=this.opacity},a.prototype.getOpacity=function(){return this.opacity===null?this.opacity=this.cssFloat("opacity"):this.opacity},a.prototype.assignStack=function(e){this.stack=e,e.children.push(this)},a.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:this.css("display")!=="none"&&this.css("visibility")!=="hidden"&&!this.node.hasAttribute("data-html2canvas-ignore")&&(this.node.nodeName!=="INPUT"||this.node.getAttribute("type")!=="hidden")},a.prototype.css=function(e){return this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null)),this.styles[e]||(this.styles[e]=this.computedStyles[e])},a.prototype.prefixedCss=function(e){var t=["webkit","moz","ms","o"],n=this.css(e);return n===undefined&&t.some(function(t){return n=this.css(t+e.substr(0,1).toUpperCase()+e.substr(1)),n!==undefined},this),n===undefined?null:n},a.prototype.computedStyle=function(e){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,e)},a.prototype.cssInt=function(e){var t=parseInt(this.css(e),10);return isNaN(t)?0:t},a.prototype.color=function(e){return this.colors[e]||(this.colors[e]=new r(this.css(e)))},a.prototype.cssFloat=function(e){var t=parseFloat(this.css(e));return isNaN(t)?0:t},a.prototype.fontWeight=function(){var e=this.css("fontWeight");switch(parseInt(e,10)){case 401:e="bold";break;case 400:e="normal"}return e},a.prototype.parseClip=function(){var e=this.css("clip").match(this.CLIP);return e?{top:parseInt(e[1],10),right:parseInt(e[2],10),bottom:parseInt(e[3],10),left:parseInt(e[4],10)}:null},a.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=o(this.css("backgroundImage")))},a.prototype.cssList=function(e,t){var n=(this.css(e)||"").split(",");return n=n[t||0]||n[0]||"auto",n=n.trim().split(" "),n.length===1&&(n=[n[0],c(n[0])?"auto":n[0]]),n},a.prototype.parseBackgroundSize=function(e,t,n){var r=this.cssList("backgroundSize",n),i,s;if(c(r[0]))i=e.width*parseFloat(r[0])/100;else{if(/contain|cover/.test(r[0])){var o=e.width/e.height,u=t.width/t.height;return o<u^r[0]==="contain"?{width:e.height*u,height:e.height}:{width:e.width,height:e.width/u}}i=parseInt(r[0],10)}return r[0]==="auto"&&r[1]==="auto"?s=t.height:r[1]==="auto"?s=i/t.width*t.height:c(r[1])?s=e.height*parseFloat(r[1])/100:s=parseInt(r[1],10),r[0]==="auto"&&(i=s/t.height*t.width),{width:i,height:s}},a.prototype.parseBackgroundPosition=function(e,t,n,r){var i=this.cssList("backgroundPosition",n),s,o;return c(i[0])?s=(e.width-(r||t).width)*(parseFloat(i[0])/100):s=parseInt(i[0],10),i[1]==="auto"?o=s/t.width*t.height:c(i[1])?o=(e.height-(r||t).height)*parseFloat(i[1])/100:o=parseInt(i[1],10),i[0]==="auto"&&(s=o/t.height*t.width),{left:s,top:o}},a.prototype.parseBackgroundRepeat=function(e){return this.cssList("backgroundRepeat",e)[0]},a.prototype.parseTextShadows=function(){var e=this.css("textShadow"),t=[];if(e&&e!=="none"){var n=e.match(this.TEXT_SHADOW_PROPERTY);for(var i=0;n&&i<n.length;i++){var s=n[i].match(this.TEXT_SHADOW_VALUES);t.push({color:new r(s[0]),offsetX:s[1]?parseFloat(s[1].replace("px","")):0,offsetY:s[2]?parseFloat(s[2].replace("px","")):0,blur:s[3]?s[3].replace("px",""):0})}}return t},a.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var e=this.parseBounds(),t=this.prefixedCss("transformOrigin").split(" ").map(h).map(p);t[0]+=e.left,t[1]+=e.top,this.transformData={origin:t,matrix:this.parseTransformMatrix()}}else this.transformData={origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData},a.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var e=this.prefixedCss("transform"),t=e?l(e.match(this.MATRIX_PROPERTY)):null;this.transformMatrix=t?t:[1,0,0,1,0,0]}return this.transformMatrix},a.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?u(this.node):s(this.node))},a.prototype.hasTransform=function(){return this.parseTransformMatrix().join(",")!=="1,0,0,1,0,0"||this.parent&&this.parent.hasTransform()},a.prototype.getValue=function(){var e=this.node.value||"";return this.node.tagName==="SELECT"?e=f(this.node):this.node.type==="password"&&(e=Array(e.length+1).join("•")),e.length===0?this.node.placeholder||"":e},a.prototype.MATRIX_PROPERTY=/(matrix|matrix3d)\((.+)\)/,a.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,a.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,a.prototype.CLIP=/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/,t.exports=a},{"./color":3,"./utils":26}],15:[function(e,t,n){function m(e,t,n,i,o){r("Starting NodeParser"),this.renderer=t,this.options=o,this.range=null,this.support=n,this.renderQueue=[],this.stack=new l(!0,1,e.ownerDocument,null);var u=new s(e,null);o.background&&t.rectangle(0,0,t.width,t.height,new f(o.background));if(e===e.ownerDocument.documentElement){var c=new s(u.color("backgroundColor").isTransparent()?e.ownerDocument.body:e.ownerDocument.documentElement,null);t.rectangle(0,0,t.width,t.height,c.color("backgroundColor"))}u.visibile=u.isElementVisible(),this.createPseudoHideStyles(e.ownerDocument),this.disableAnimations(e.ownerDocument),this.nodes=K([u].concat(this.getChildren(u)).filter(function(e){return e.visible=e.isElementVisible()}).map(this.getPseudoElements,this));for(var p=0;p<this.nodes.length;p++){var d=this.nodes[p],v=d.node,m={top:d.node.offsetTop,left:d.node.offsetLeft,width:d.node.offsetWidth,height:d.node.offsetHeight};while(v.offsetParent)v=v.offsetParent,m.top+=v.offsetTop,m.left+=v.offsetLeft;if(d&&d.node&&d.node.nodeName=="IMG"){if(!d.visible){d.node.src="about:blank";continue}if(m.top>o.rectangle.bottom||m.left+m.width<o.rectangle.left||m.top+m.height<o.rectangle.top||m.left>o.rectangle.right){d.node.src="about:blank";continue}continue}if(d&&d.node&&d.node.nodeName!="#text"){if(!d.visible){d.styles.background="none",d.styles.backgroundImage="none";continue}if(m.top>o.rectangle.bottom||m.left+m.width<o.rectangle.left||m.top+m.height<o.rectangle.top||m.left>o.rectangle.right){d.styles.background="none",d.styles.backgroundImage="none";continue}}}this.fontMetrics=new a,r("Fetched nodes, total:",this.nodes.length),r("Calculate overflow clips"),this.calculateOverflowClips(),r("Start fetching images"),this.images=i.fetch(this.nodes.filter(R)),this.ready=this.images.ready.then(h(function(){return r("Images loaded, starting parsing"),r("Creating stacking contexts"),this.createStackingContexts(),r("Sorting stacking contexts"),this.sortStackingContexts(this.stack),this.parse(this.stack),r("Render queue created with "+this.renderQueue.length+" items"),new Promise(h(function(e){o.async?typeof o.async=="function"?o.async.call(this,this.renderQueue,e):this.renderQueue.length>0?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,e)):e():(this.renderQueue.forEach(this.paint,this),e())},this))},this))}function g(e){return e.parent&&e.parent.clip.length}function y(e){return e.replace(/(\-[a-z])/g,function(e){return e.toUpperCase().replace("-","")})}function b(){}function E(e,t,n,r){return e.map(function(i,s){if(i.width>0){var o=t.left,u=t.top,a=t.width,f=t.height-e[2].width;switch(s){case 0:f=e[0].width,i.args=N({c1:[o,u],c2:[o+a,u],c3:[o+a-e[1].width,u+f],c4:[o+e[3].width,u+f]},r[0],r[1],n.topLeftOuter,n.topLeftInner,n.topRightOuter,n.topRightInner);break;case 1:o=t.left+t.width-e[1].width,a=e[1].width,i.args=N({c1:[o+a,u],c2:[o+a,u+f+e[2].width],c3:[o,u+f],c4:[o,u+e[0].width]},r[1],r[2],n.topRightOuter,n.topRightInner,n.bottomRightOuter,n.bottomRightInner);break;case 2:u=u+t.height-e[2].width,f=e[2].width,i.args=N({c1:[o+a,u+f],c2:[o,u+f],c3:[o+e[3].width,u],c4:[o+a-e[3].width,u]},r[2],r[3],n.bottomRightOuter,n.bottomRightInner,n.bottomLeftOuter,n.bottomLeftInner);break;case 3:a=e[3].width,i.args=N({c1:[o,u+f+e[2].width],c2:[o,u],c3:[o+a,u+e[0].width],c4:[o+a,u+f]},r[3],r[0],n.bottomLeftOuter,n.bottomLeftInner,n.topLeftOuter,n.topLeftInner)}}return i})}function S(e,t,n,r){var i=4*((Math.sqrt(2)-1)/3),s=n*i,o=r*i,u=e+n,a=t+r;return{topLeft:T({x:e,y:a},{x:e,y:a-o},{x:u-s,y:t},{x:u,y:t}),topRight:T({x:e,y:t},{x:e+s,y:t},{x:u,y:a-o},{x:u,y:a}),bottomRight:T({x:u,y:t},{x:u,y:t+o},{x:e+s,y:a},{x:e,y:a}),bottomLeft:T({x:u,y:a},{x:u-s,y:a},{x:e,y:t+o},{x:e,y:t})}}function x(e,t,n){var r=e.left,i=e.top,s=e.width,o=e.height,u=t[0][0]<s/2?t[0][0]:s/2,a=t[0][1]<o/2?t[0][1]:o/2,f=t[1][0]<s/2?t[1][0]:s/2,l=t[1][1]<o/2?t[1][1]:o/2,c=t[2][0]<s/2?t[2][0]:s/2,h=t[2][1]<o/2?t[2][1]:o/2,p=t[3][0]<s/2?t[3][0]:s/2,d=t[3][1]<o/2?t[3][1]:o/2,v=s-f,m=o-h,g=s-c,y=o-d;return{topLeftOuter:S(r,i,u,a).topLeft.subdivide(.5),topLeftInner:S(r+n[3].width,i+n[0].width,Math.max(0,u-n[3].width),Math.max(0,a-n[0].width)).topLeft.subdivide(.5),topRightOuter:S(r+v,i,f,l).topRight.subdivide(.5),topRightInner:S(r+Math.min(v,s+n[3].width),i+n[0].width,v>s+n[3].width?0:f-n[3].width,l-n[0].width).topRight.subdivide(.5),bottomRightOuter:S(r+g,i+m,c,h).bottomRight.subdivide(.5),bottomRightInner:S(r+Math.min(g,s-n[3].width),i+Math.min(m,o+n[0].width),Math.max(0,c-n[1].width),h-n[2].width).bottomRight.subdivide(.5),bottomLeftOuter:S(r,i+y,p,d).bottomLeft.subdivide(.5),bottomLeftInner:S(r+n[3].width,i+y,Math.max(0,p-n[3].width),d-n[2].width).bottomLeft.subdivide(.5)}}function T(e,t,n,r){var i=function(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}};return{start:e,startControl:t,endControl:n,end:r,subdivide:function(s){var o=i(e,t,s),u=i(t,n,s),a=i(n,r,s),f=i(o,u,s),l=i(u,a,s),c=i(f,l,s);return[T(e,o,f,c),T(c,l,a,r)]},curveTo:function(e){e.push(["bezierCurve",t.x,t.y,n.x,n.y,r.x,r.y])},curveToReversed:function(r){r.push(["bezierCurve",n.x,n.y,t.x,t.y,e.x,e.y])}}}function N(e,t,n,r,i,s,o){var u=[];return t[0]>0||t[1]>0?(u.push(["line",r[1].start.x,r[1].start.y]),r[1].curveTo(u)):u.push(["line",e.c1[0],e.c1[1]]),n[0]>0||n[1]>0?(u.push(["line",s[0].start.x,s[0].start.y]),s[0].curveTo(u),u.push(["line",o[0].end.x,o[0].end.y]),o[0].curveToReversed(u)):(u.push(["line",e.c2[0],e.c2[1]]),u.push(["line",e.c3[0],e.c3[1]])),t[0]>0||t[1]>0?(u.push(["line",i[1].end.x,i[1].end.y]),i[1].curveToReversed(u)):u.push(["line",e.c4[0],e.c4[1]]),u}function C(e,t,n,r,i,s,o){t[0]>0||t[1]>0?(e.push(["line",r[0].start.x,r[0].start.y]),r[0].curveTo(e),r[1].curveTo(e)):e.push(["line",s,o]),(n[0]>0||n[1]>0)&&e.push(["line",i[0].start.x,i[0].start.y])}function k(e){return e.cssInt("zIndex")<0}function L(e){return e.cssInt("zIndex")>0}function A(e){return e.cssInt("zIndex")===0}function O(e){return["inline","inline-block","inline-table"].indexOf(e.css("display"))!==-1}function M(e){return e instanceof l}function _(e){return e.node.data.trim().length>0}function D(e){return/^(normal|none|0px)$/.test(e.parent.css("letterSpacing"))}function P(e){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){var n=e.css("border"+t+"Radius"),r=n.split(" ");return r.length<=1&&(r[1]=r[0]),r.map(V)})}function H(e){return e.nodeType===Node.TEXT_NODE||e.nodeType===Node.ELEMENT_NODE}function B(e){var t=e.css("position"),n=["absolute","relative","fixed"].indexOf(t)!==-1?e.css("zIndex"):"auto";return n!=="auto"}function j(e){return e.css("position")!=="static"}function F(e){return e.css("float")!=="none"}function I(e){return["inline-block","inline-table"].indexOf(e.css("display"))!==-1}function q(e){var t=this;return function(){return!e.apply(t,arguments)}}function R(e){return e.node.nodeType===Node.ELEMENT_NODE}function U(e){return e.isPseudoElement===!0}function z(e){return e.node.nodeType===Node.TEXT_NODE}function W(e){return function(t,n){return t.cssInt("zIndex")+e.indexOf(t)/e.length-(n.cssInt("zIndex")+e.indexOf(n)/e.length)}}function X(e){return e.getOpacity()<1}function V(e){return parseInt(e,10)}function $(e){return e.width}function J(e){return e.node.nodeType!==Node.ELEMENT_NODE||["SCRIPT","HEAD","TITLE","OBJECT","BR","OPTION"].indexOf(e.node.nodeName)===-1}function K(e){return[].concat.apply([],e)}function Q(e){var t=e.substr(0,1);return t===e.substr(e.length-1)&&t.match(/'|"/)?e.substr(1,e.length-2):e}function G(e){var t=[],n=0,r=!1,s;while(e.length)Y(e[n])===r?(s=e.splice(0,n),s.length&&t.push(i.ucs2.encode(s)),r=!r,n=0):n++,n>=e.length&&(s=e.splice(0,n),s.length&&t.push(i.ucs2.encode(s)));return t}function Y(e){return[32,13,10,9,45].indexOf(e)!==-1}function Z(e){return/[^\u0000-\u00ff]/.test(e)}var r=e("./log"),i=e("punycode"),s=e("./nodecontainer"),o=e("./textcontainer"),u=e("./pseudoelementcontainer"),a=e("./fontmetrics"),f=e("./color"),l=e("./stackingcontext"),c=e("./utils"),h=c.bind,p=c.getBounds,d=c.parseBackgrounds,v=c.offsetBounds;m.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(e){if(R(e)){U(e)&&e.appendToDOM(),e.borders=this.parseBorders(e);var t=e.css("overflow")==="hidden"?[e.borders.clip]:[],n=e.parseClip();n&&["absolute","fixed"].indexOf(e.css("position"))!==-1&&t.push([["rect",e.bounds.left+n.left,e.bounds.top+n.top,n.right-n.left,n.bottom-n.top]]),e.clip=g(e)?e.parent.clip.concat(t):t,e.backgroundClip=e.css("overflow")!=="hidden"?e.clip.concat([e.borders.clip]):e.clip,U(e)&&e.cleanDOM()}else z(e)&&(e.clip=g(e)?e.parent.clip:[]);U(e)||(e.bounds=null)},this)},m.prototype.asyncRenderer=function(e,t,n){n=n||Date.now(),this.paint(e[this.renderIndex++]),e.length===this.renderIndex?t():n+20>Date.now()?this.asyncRenderer(e,t,n):setTimeout(h(function(){this.asyncRenderer(e,t)},this),0)},m.prototype.createPseudoHideStyles=function(e){this.createStyles(e,"."+u.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }'+"."+u.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')},m.prototype.disableAnimations=function(e){this.createStyles(e,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")},m.prototype.createStyles=function(e,t){var n=e.createElement("style");n.innerHTML=t,e.body.appendChild(n)},m.prototype.getPseudoElements=function(e){var t=[[e]];if(e.node.nodeType===Node.ELEMENT_NODE){var n=this.getPseudoElement(e,":before"),r=this.getPseudoElement(e,":after");n&&t.push(n),r&&t.push(r)}return K(t)},m.prototype.getPseudoElement=function(e,t){var n=e.computedStyle(t);if(!n||!n.content||n.content==="none"||n.content==="-moz-alt-content"||n.display==="none")return null;var r=Q(n.content),i=r.substr(0,3)==="url",s=document.createElement(i?"img":"html2canvaspseudoelement"),a=new u(s,e,t);for(var f=n.length-1;f>=0;f--){var l=y(n.item(f));s.style[l]=n[l]}s.className=u.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+u.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER;if(i)return s.src=d(r)[0].args[0],[a];var c=document.createTextNode(r);return s.appendChild(c),[a,new o(c,a)]},m.prototype.getChildren=function(e){return K([].filter.call(e.node.childNodes,H).map(function(t){var n=[t.nodeType===Node.TEXT_NODE?new o(t,e):new s(t,e)].filter(J);return t.nodeType===Node.ELEMENT_NODE&&n.length&&t.tagName!=="TEXTAREA"?n[0].isElementVisible()?n.concat(this.getChildren(n[0])):[]:n},this))},m.prototype.newStackingContext=function(e,t){var n=new l(t,e.getOpacity(),e.node,e.parent);e.cloneTo(n);var r=t?n.getParentStack(this):n.parent.stack;r.contexts.push(n),e.stack=n},m.prototype.createStackingContexts=function(){this.nodes.forEach(function(e){R(e)&&(this.isRootElement(e)||X(e)||B(e)||this.isBodyWithTransparentRoot(e)||e.hasTransform())?this.newStackingContext(e,!0):R(e)&&(j(e)&&A(e)||I(e)||F(e))?this.newStackingContext(e,!1):e.assignStack(e.parent.stack)},this)},m.prototype.isBodyWithTransparentRoot=function(e){return e.node.nodeName==="BODY"&&e.parent.color("backgroundColor").isTransparent()},m.prototype.isRootElement=function(e){return e.parent===null},m.prototype.sortStackingContexts=function(e){e.contexts.sort(W(e.contexts.slice(0))),e.contexts.forEach(this.sortStackingContexts,this)},m.prototype.parseTextBounds=function(e){return function(t,n,r){if(e.parent.css("textDecoration").substr(0,4)!=="none"||t.trim().length!==0){if(this.support.rangeBounds&&!e.parent.hasTransform()){var i=r.slice(0,n).join("").length;return this.getRangeBounds(e.node,i,t.length)}if(e.node&&typeof e.node.data=="string"){var s=e.node.splitText(t.length),o=this.getWrapperBounds(e.node,e.parent.hasTransform());return e.node=s,o}}else if(!this.support.rangeBounds||e.parent.hasTransform())e.node=e.node.splitText(t.length);return{}}},m.prototype.getWrapperBounds=function(e,t){var n=e.ownerDocument.createElement("html2canvaswrapper"),r=e.parentNode,i=e.cloneNode(!0);n.appendChild(e.cloneNode(!0)),r.replaceChild(n,e);var s=t?v(n):p(n);return r.replaceChild(i,n),s},m.prototype.getRangeBounds=function(e,t,n){var r=this.range||(this.range=e.ownerDocument.createRange());return r.setStart(e,t),r.setEnd(e,t+n),r.getBoundingClientRect()},m.prototype.parse=function(e){var t=e.contexts.filter(k),n=e.children.filter(R),r=n.filter(q(F)),i=r.filter(q(j)).filter(q(O)),s=n.filter(q(j)).filter(F),o=r.filter(q(j)).filter(O),u=e.contexts.concat(r.filter(j)).filter(A),a=e.children.filter(z).filter(_),f=e.contexts.filter(L);t.concat(i).concat(s).concat(o).concat(u).concat(a).concat(f).forEach(function(e){this.renderQueue.push(e),M(e)&&(this.parse(e),this.renderQueue.push(new b))},this)},m.prototype.paint=function(e){try{e instanceof b?this.renderer.ctx.restore():z(e)?(U(e.parent)&&e.parent.appendToDOM(),this.paintText(e),U(e.parent)&&e.parent.cleanDOM()):this.paintNode(e)}catch(t){r(t);if(this.options.strict)throw t}},m.prototype.paintNode=function(e){M(e)&&(this.renderer.setOpacity(e.opacity),this.renderer.ctx.save(),e.hasTransform()&&this.renderer.setTransform(e.parseTransform())),e.node.nodeName==="INPUT"&&e.node.type==="checkbox"?this.paintCheckbox(e):e.node.nodeName==="INPUT"&&e.node.type==="radio"?this.paintRadio(e):this.paintElement(e)},m.prototype.paintElement=function(e){var t=e.parseBounds();this.renderer.clip(e.backgroundClip,function(){this.renderer.renderBackground(e,t,e.borders.borders.map($))},this),this.renderer.clip(e.clip,function(){this.renderer.renderBorders(e.borders.borders)},this),this.renderer.clip(e.backgroundClip,function(){switch(e.node.nodeName){case"svg":case"IFRAME":var n=this.images.get(e.node);n?this.renderer.renderImage(e,t,e.borders,n):r("Error loading <"+e.node.nodeName+">",e.node);break;case"IMG":var i=this.images.get(e.node.src);i?this.renderer.renderImage(e,t,e.borders,i):r("Error loading <img>",e.node.src);break;case"CANVAS":this.renderer.renderImage(e,t,e.borders,{image:e.node});break;case"SELECT":case"INPUT":case"TEXTAREA":this.paintFormValue(e)}},this)},m.prototype.paintCheckbox=function(e){var t=e.parseBounds(),n=Math.min(t.width,t.height),r={width:n-1,height:n-1,top:t.top,left:t.left},i=[3,3],s=[i,i,i,i],o=[1,1,1,1].map(function(e){return{color:new f("#A5A5A5"),width:e}}),u=x(r,s,o);this.renderer.clip(e.backgroundClip,function(){this.renderer.rectangle(r.left+1,r.top+1,r.width-2,r.height-2,new f("#DEDEDE")),this.renderer.renderBorders(E(o,r,u,s)),e.node.checked&&(this.renderer.font(new f("#424242"),"normal","normal","bold",n-3+"px","arial"),this.renderer.text("✔",r.left+n/6,r.top+n-1))},this)},m.prototype.paintRadio=function(e){var t=e.parseBounds(),n=Math.min(t.width,t.height)-2;this.renderer.clip(e.backgroundClip,function(){this.renderer.circleStroke(t.left+1,t.top+1,n,new f("#DEDEDE"),1,new f("#A5A5A5")),e.node.checked&&this.renderer.circle(Math.ceil(t.left+n/4)+1,Math.ceil(t.top+n/4)+1,Math.floor(n/2),new f("#424242"))},this)},m.prototype.paintFormValue=function(e){var t=e.getValue();if(t.length>0){var n=e.node.ownerDocument,i=n.createElement("html2canvaswrapper"),s=["lineHeight","textAlign","fontFamily","fontWeight","fontSize","color","paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","borderLeftStyle","borderTopStyle","borderLeftWidth","borderTopWidth","boxSizing","whiteSpace","wordWrap"];s.forEach(function(t){try{i.style[t]=e.css(t)}catch(n){r("html2canvas: Parse: Exception caught in renderFormValue: "+n.message)}});var u=e.parseBounds();i.style.position="fixed",i.style.left=u.left+"px",i.style.top=u.top+"px",i.textContent=t,n.body.appendChild(i),this.paintText(new o(i.firstChild,e)),n.body.removeChild(i)}},m.prototype.paintText=function(e){e.applyTextTransform();var t=i.ucs2.decode(e.node.data),n=(!this.options.letterRendering||D(e))&&!Z(e.node.data)?G(t):t.map(function(e){return i.ucs2.encode([e])}),r=e.parent.fontWeight(),s=e.parent.css("fontSize"),o=e.parent.css("fontFamily"),u=e.parent.parseTextShadows();this.renderer.font(e.parent.color("color"),e.parent.css("fontStyle"),e.parent.css("fontVariant"),r,s,o),u.length?this.renderer.fontShadow(u[0].color,u[0].offsetX,u[0].offsetY,u[0].blur):this.renderer.clearShadow(),this.renderer.clip(e.parent.clip,function(){n.map(this.parseTextBounds(e),this).forEach(function(t,r){t&&(this.renderer.text(n[r],t.left,t.bottom),this.renderTextDecoration(e.parent,t,this.fontMetrics.getMetrics(o,s)))},this)},this)},m.prototype.renderTextDecoration=function(e,t,n){switch(e.css("textDecoration").split(" ")[0]){case"underline":this.renderer.rectangle(t.left,Math.round(t.top+n.baseline+n.lineWidth),t.width,1,e.color("color"));break;case"overline":this.renderer.rectangle(t.left,Math.round(t.top),t.width,1,e.color("color"));break;case"line-through":this.renderer.rectangle(t.left,Math.ceil(t.top+n.middle+n.lineWidth),t.width,1,e.color("color"))}};var w={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};m.prototype.parseBorders=function(e){var t=e.parseBounds(),n=P(e),r=["Top","Right","Bottom","Left"].map(function(t,n){var r=e.css("border"+t+"Style"),i=e.color("border"+t+"Color");r==="inset"&&i.isBlack()&&(i=new f([255,255,255,i.a]));var s=w[r]?w[r][n]:null;return{width:e.cssInt("border"+t+"Width"),color:s?i[s[0]](s[1]):i,args:null}}),i=x(t,n,r);return{clip:this.parseBackgroundClip(e,i,r,n,t),borders:E(r,t,i,n)}},m.prototype.parseBackgroundClip=function(e,t,n,r,i){var s=e.css("backgroundClip"),o=[];switch(s){case"content-box":case"padding-box":C(o,r[0],r[1],t.topLeftInner,t.topRightInner,i.left+n[3].width,i.top+n[0].width),C(o,r[1],r[2],t.topRightInner,t.bottomRightInner,i.left+i.width-n[1].width,i.top+n[0].width),C(o,r[2],r[3],t.bottomRightInner,t.bottomLeftInner,i.left+i.width-n[1].width,i.top+i.height-n[2].width),C(o,r[3],r[0],t.bottomLeftInner,t.topLeftInner,i.left+n[3].width,i.top+i.height-n[2].width);break;default:C(o,r[0],r[1],t.topLeftOuter,t.topRightOuter,i.left,i.top),C(o,r[1],r[2],t.topRightOuter,t.bottomRightOuter,i.left+i.width,i.top),C(o,r[2],r[3],t.bottomRightOuter,t.bottomLeftOuter,i.left+i.width,i.top+i.height),C(o,r[3],r[0],t.bottomLeftOuter,t.topLeftOuter,i.left,i.top+i.height)}return o},t.exports=m},{"./color":3,"./fontmetrics":7,"./log":13,"./nodecontainer":14,"./pseudoelementcontainer":18,"./stackingcontext":21,"./textcontainer":25,"./utils":26,punycode:1}],16:[function(e,t,n){function f(e,t,n){var r="withCredentials"in new XMLHttpRequest;if(!t)return Promise.reject("No proxy configured");var s=p(r),o=d(t,e,s);return r?i(o):h(n,o,s).then(function(e){return a(e.content)})}function c(e,t,n){var r="crossOrigin"in new Image,i=p(r),s=d(t,e,i);return r?Promise.resolve(s):h(n,s,i).then(function(e){return"data:"+e.type+";base64,"+e.content})}function h(e,t,n){return new Promise(function(i,s){var o=e.createElement("script"),u=function(){delete r.html2canvas.proxy[n],e.body.removeChild(o)};r.html2canvas.proxy[n]=function(e){u(),i(e)},o.src=t,o.onerror=function(e){u(),s(e)},e.body.appendChild(o)})}function p(e){return e?"":"html2canvas_"+Date.now()+"_"+ ++l+"_"+Math.round(Math.random()*1e5)}function d(e,t,n){return e+"?url="+encodeURIComponent(t)+(n.length?"&callback=html2canvas.proxy."+n:"")}function v(e){return function(t){var n=new DOMParser,r;try{r=n.parseFromString(t,"text/html")}catch(i){o("DOMParser not supported, falling back to createHTMLDocument"),r=document.implementation.createHTMLDocument("");try{r.open(),r.write(t),r.close()}catch(s){o("createHTMLDocument write not supported, falling back to document.body.innerHTML"),r.body.innerHTML=t}}var u=r.querySelector("base");if(!u||!u.href.host){var a=r.createElement("base");a.href=e,r.head.insertBefore(a,r.head.firstChild)}return r}}function m(e,t,n,r,i,s){return(new f(e,t,window.document)).then(v(e)).then(function(e){return u(e,n,r,i,s,0,0)})}var i=e("./xhr"),s=e("./utils"),o=e("./log"),u=e("./clone"),a=s.decode64,l=0;n.Proxy=f,n.ProxyURL=c,n.loadUrlDocument=m},{"./clone":2,"./log":13,"./utils":26,"./xhr":28}],17:[function(e,t,n){function i(e,t){var n=document.createElement("a");n.href=e,e=n.href,this.src=e,this.image=new Image;var i=this;this.promise=new Promise(function(n,s){i.image.crossOrigin="Anonymous",i.image.onload=n,i.image.onerror=s,(new r(e,t,document)).then(function(e){i.image.src=e})["catch"](s)})}var r=e("./proxy").ProxyURL;t.exports=i},{"./proxy":16}],18:[function(e,t,n){function i(e,t,n){r.call(this,e,t),this.isPseudoElement=!0,this.before=n===":before"}var r=e("./nodecontainer");i.prototype.cloneTo=function(e){i.prototype.cloneTo.call(this,e),e.isPseudoElement=!0,e.before=this.before},i.prototype=Object.create(r.prototype),i.prototype.appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node),this.parent.node.className+=" "+this.getHideClass()},i.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node),this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")},i.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+(this.before?"BEFORE":"AFTER")]},i.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",i.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",t.exports=i},{"./nodecontainer":14}],19:[function(e,t,n){function i(e,t,n,r,i){this.width=e,this.height=t,this.images=n,this.options=r,this.document=i}var r=e("./log");i.prototype.renderImage=function(e,t,n,r){var i=e.cssInt("paddingLeft"),s=e.cssInt("paddingTop"),o=e.cssInt("paddingRight"),u=e.cssInt("paddingBottom"),a=n.borders,f=t.width-(a[1].width+a[3].width+i+o),l=t.height-(a[0].width+a[2].width+s+u);this.drawImage(r,0,0,r.image.width||f,r.image.height||l,t.left+i+a[3].width,t.top+s+a[0].width,f,l)},i.prototype.renderBackground=function(e,t,n){t.height>0&&t.width>0&&(this.renderBackgroundColor(e,t),this.renderBackgroundImage(e,t,n))},i.prototype.renderBackgroundColor=function(e,t){var n=e.color("backgroundColor");n.isTransparent()||this.rectangle(t.left,t.top,t.width,t.height,n)},i.prototype.renderBorders=function(e){e.forEach(this.renderBorder,this)},i.prototype.renderBorder=function(e){!e.color.isTransparent()&&e.args!==null&&this.drawShape(e.args,e.color)},i.prototype.renderBackgroundImage=function(e,t,n){var i=e.parseBackgroundImages();i.reverse().forEach(function(i,s,o){switch(i.method){case"url":var u=this.images.get(i.args[0]);u?this.renderBackgroundRepeating(e,t,u,o.length-(s+1),n):r("Error loading background-image",i.args[0]);break;case"linear-gradient":case"gradient":var a=this.images.get(i.value);a?this.renderBackgroundGradient(a,t,n):r("Error loading background-image",i.args[0]);break;case"none":break;default:r("Unknown background-image type",i.args[0])}},this)},i.prototype.renderBackgroundRepeating=function(e,t,n,r,i){var s=e.parseBackgroundSize(t,n.image,r),o=e.parseBackgroundPosition(t,n.image,r,s),u=e.parseBackgroundRepeat(r);switch(u){case"repeat-x":case"repeat no-repeat":this.backgroundRepeatShape(n,o,s,t,t.left+i[3],t.top+o.top+i[0],99999,s.height,i);break;case"repeat-y":case"no-repeat repeat":this.backgroundRepeatShape(n,o,s,t,t.left+o.left+i[3],t.top+i[0],s.width,99999,i);break;case"no-repeat":this.backgroundRepeatShape(n,o,s,t,t.left+o.left+i[3],t.top+o.top+i[0],s.width,s.height,i);break;default:this.renderBackgroundRepeat(n,o,s,{top:t.top,left:t.left},i[3],i[0])}},t.exports=i},{"./log":13}],20:[function(e,t,n){function o(e,t){r.apply(this,arguments),this.canvas=this.options.canvas||this.document.createElement("canvas"),this.options.canvas||(this.canvas.width=e,this.canvas.height=t),this.ctx=this.canvas.getContext("2d"),this.taintCtx=this.document.createElement("canvas").getContext("2d"),this.ctx.textBaseline="bottom",this.variables={},s("Initialized CanvasRenderer with size",e,"x",t)}function u(e){return e.length>0}var r=e("../renderer"),i=e("../lineargradientcontainer"),s=e("../log");o.prototype=Object.create(r.prototype),o.prototype.setFillStyle=function(e){return this.ctx.fillStyle=typeof e!="object"||!e.isColor?e:e.toString(),this.ctx},o.prototype.rectangle=function(e,t,n,r,i){this.setFillStyle(i).fillRect(e,t,n,r)},o.prototype.circle=function(e,t,n,r){this.setFillStyle(r),this.ctx.beginPath(),this.ctx.arc(e+n/2,t+n/2,n/2,0,Math.PI*2,!0),this.ctx.closePath(),this.ctx.fill()},o.prototype.circleStroke=function(e,t,n,r,i,s){this.circle(e,t,n,r),this.ctx.strokeStyle=s.toString(),this.ctx.stroke()},o.prototype.drawShape=function(e,t){this.shape(e),this.setFillStyle(t).fill()},o.prototype.taints=function(e){if(e.tainted===null){this.taintCtx.drawImage(e.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),e.tainted=!1}catch(t){this.taintCtx=document.createElement("canvas").getContext("2d"),e.tainted=!0}}return e.tainted},o.prototype.drawImage=function(e,t,n,r,i,s,o,u,a){(!this.taints(e)||this.options.allowTaint)&&this.ctx.drawImage(e.image,t,n,r,i,s,o,u,a)},o.prototype.clip=function(e,t,n){this.ctx.save(),e.filter(u).forEach(function(e){this.shape(e).clip()},this),t.call(n),this.ctx.restore()},o.prototype.shape=function(e){return this.ctx.beginPath(),e.forEach(function(e,t){e[0]==="rect"?this.ctx.rect.apply(this.ctx,e.slice(1)):this.ctx[t===0?"moveTo":e[0]+"To"].apply(this.ctx,e.slice(1))},this),this.ctx.closePath(),this.ctx},o.prototype.font=function(e,t,n,r,i,s){this.setFillStyle(e).font=[t,n,r,i,s].join(" ").split(",")[0]},o.prototype.fontShadow=function(e,t,n,r){this.setVariable("shadowColor",e.toString()).setVariable("shadowOffsetY",t).setVariable("shadowOffsetX",n).setVariable("shadowBlur",r)},o.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")},o.prototype.setOpacity=function(e){this.ctx.globalAlpha=e},o.prototype.setTransform=function(e){this.ctx.translate(e.origin[0],e.origin[1]),this.ctx.transform.apply(this.ctx,e.matrix),this.ctx.translate(-e.origin[0],-e.origin[1])},o.prototype.setVariable=function(e,t){return this.variables[e]!==t&&(this.variables[e]=this.ctx[e]=t),this},o.prototype.text=function(e,t,n){this.ctx.fillText(e,t,n)},o.prototype.backgroundRepeatShape=function(e,t,n,r,i,s,o,u,a){var f=[["line",Math.round(i),Math.round(s)],["line",Math.round(i+o),Math.round(s)],["line",Math.round(i+o),Math.round(u+s)],["line",Math.round(i),Math.round(u+s)]];this.clip([f],function(){this.renderBackgroundRepeat(e,t,n,r,a[3],a[0])},this)},o.prototype.renderBackgroundRepeat=function(e,t,n,r,i,s){var o=Math.round(r.left+t.left+i),u=Math.round(r.top+t.top+s);this.setFillStyle(this.ctx.createPattern(this.resizeImage(e,n),"repeat")),this.ctx.translate(o,u),this.ctx.fill(),this.ctx.translate(-o,-u)},o.prototype.renderBackgroundGradient=function(e,t){if(e instanceof i){var n=this.ctx.createLinearGradient(t.left+t.width*e.x0,t.top+t.height*e.y0,t.left+t.width*e.x1,t.top+t.height*e.y1);e.colorStops.forEach(function(e){n.addColorStop(e.stop,e.color.toString())}),this.rectangle(t.left,t.top,t.width,t.height,n)}},o.prototype.resizeImage=function(e,t){var n=e.image;if(n.width===t.width&&n.height===t.height)return n;var r,i=document.createElement("canvas");return i.width=t.width,i.height=t.height,r=i.getContext("2d"),r.drawImage(n,0,0,n.width,n.height,0,0,t.width,t.height),i},t.exports=o},{"../lineargradientcontainer":12,"../log":13,"../renderer":19}],21:[function(e,t,n){function i(e,t,n,i){r.call(this,n,i),this.ownStacking=e,this.contexts=[],this.children=[],this.opacity=(this.parent?this.parent.stack.opacity:1)*t}var r=e("./nodecontainer");i.prototype=Object.create(r.prototype),i.prototype.getParentStack=function(e){var t=this.parent?this.parent.stack:null;return t?t.ownStacking?t:t.getParentStack(e):e.stack},t.exports=i},{"./nodecontainer":14}],22:[function(e,t,n){function r(e){this.rangeBounds=this.testRangeBounds(e),this.cors=this.testCORS(),this.svg=this.testSVG()}r.prototype.testRangeBounds=function(e){var t,n,r,i,s=!1;return e.createRange&&(t=e.createRange(),t.getBoundingClientRect&&(n=e.createElement("boundtest"),n.style.height="123px",n.style.display="block",e.body.appendChild(n),t.selectNode(n),r=t.getBoundingClientRect(),i=r.height,i===123&&(s=!0),e.body.removeChild(n))),s},r.prototype.testCORS=function(){return typeof (new Image).crossOrigin!="undefined"},r.prototype.testSVG=function(){var e=new Image,t=document.createElement("canvas"),n=t.getContext("2d");e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(e,0,0),t.toDataURL()}catch(r){return!1}return!0},t.exports=r},{}],23:[function(e,t,n){function o(e){this.src=e,this.image=null;var t=this;this.promise=this.hasFabric().then(function(){return t.isInline(e)?Promise.resolve(t.inlineFormatting(e)):i(e)}).then(function(e){return new Promise(function(n){r.html2canvas.svg.fabric.loadSVGFromString(e,t.createCanvas.call(t,n))})})}var i=e("./xhr"),s=e("./utils").decode64;o.prototype.hasFabric=function(){return!r.html2canvas.svg||!r.html2canvas.svg.fabric?Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg")):Promise.resolve()},o.prototype.inlineFormatting=function(e){return/^data:image\/svg\+xml;base64,/.test(e)?this.decode64(this.removeContentType(e)):this.removeContentType(e)},o.prototype.removeContentType=function(e){return e.replace(/^data:image\/svg\+xml(;base64)?,/,"")},o.prototype.isInline=function(e){return/^data:image\/svg\+xml/i.test(e)},o.prototype.createCanvas=function(e){var t=this;return function(n,i){var s=new r.html2canvas.svg.fabric.StaticCanvas("c");t.image=s.lowerCanvasEl,s.setWidth(i.width).setHeight(i.height).add(r.html2canvas.svg.fabric.util.groupSVGElements(n,i)).renderAll(),e(s.lowerCanvasEl)}},o.prototype.decode64=function(e){return typeof window.atob=="function"?window.atob(e):s(e)},t.exports=o},{"./utils":26,"./xhr":28}],24:[function(e,t,n){function s(e,t){this.src=e,this.image=null;var n=this;this.promise=t?new Promise(function(t,r){n.image=new Image,n.image.onload=t,n.image.onerror=r,n.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(e),n.image.complete===!0&&t(n.image)}):this.hasFabric().then(function(){return new Promise(function(t){r.html2canvas.svg.fabric.parseSVGDocument(e,n.createCanvas.call(n,t))})})}var i=e("./svgcontainer");s.prototype=Object.create(i.prototype),t.exports=s},{"./svgcontainer":23}],25:[function(e,t,n){function i(e,t){r.call(this,e,t)}function s(e,t,n){if(e.length>0)return t+n.toUpperCase()}var r=e("./nodecontainer");i.prototype=Object.create(r.prototype),i.prototype.applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))},i.prototype.transform=function(e){var t=this.node.data;switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,s);case"uppercase":return t.toUpperCase();default:return t}},t.exports=i},{"./nodecontainer":14}],26:[function(e,t,n){n.smallImage=function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},n.bind=function(e,t){return function(){return e.apply(t,arguments)}},n.decode64=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=e.length,r,i,s,o,u,a,f,l,c="";for(r=0;r<n;r+=4)i=t.indexOf(e[r]),s=t.indexOf(e[r+1]),o=t.indexOf(e[r+2]),u=t.indexOf(e[r+3]),a=i<<2|s>>4,f=(s&15)<<4|o>>2,l=(o&3)<<6|u,o===64?c+=String.fromCharCode(a):u===64||u===-1?c+=String.fromCharCode(a,f):c+=String.fromCharCode(a,f,l);return c},n.getBounds=function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect(),n=e.offsetWidth==null?t.width:e.offsetWidth;return{top:t.top,bottom:t.bottom||t.top+t.height,right:t.left+n,left:t.left,width:n,height:e.offsetHeight==null?t.height:e.offsetHeight}}return{}},n.offsetBounds=function(e){var t=e.offsetParent?n.offsetBounds(e.offsetParent):{top:0,left:0};return{top:e.offsetTop+t.top,bottom:e.offsetTop+e.offsetHeight+t.top,right:e.offsetLeft+t.left+e.offsetWidth,left:e.offsetLeft+t.left,width:e.offsetWidth,height:e.offsetHeight}},n.parseBackgrounds=function(e){var t=" \r\n	",n,r,i,s,o,u=[],a=0,f=0,l,c,h=function(){n&&(r.substr(0,1)==='"'&&(r=r.substr(1,r.length-2)),r&&c.push(r),n.substr(0,1)==="-"&&(s=n.indexOf("-",1)+1)>0&&(i=n.substr(0,s),n=n.substr(s)),u.push({prefix:i,method:n.toLowerCase(),value:o,args:c,image:null})),c=[],n=i=r=o=""};return c=[],n=i=r=o="",e.split("").forEach(function(e){if(a===0&&t.indexOf(e)>-1)return;switch(e){case'"':l?l===e&&(l=null):l=e;break;case"(":if(l)break;if(a===0){a=1,o+=e;return}f++;break;case")":if(l)break;if(a===1){if(f===0){a=0,o+=e,h();return}f--}break;case",":if(l)break;if(a===0){h();return}if(a===1&&f===0&&!n.match(/^url$/i)){c.push(r),r="",o+=e;return}}o+=e,a===0?n+=e:r+=e}),h(),u}},{}],27:[function(e,t,n){function i(e){r.apply(this,arguments),this.type=e.args[0]==="linear"?r.TYPES.LINEAR:r.TYPES.RADIAL}var r=e("./gradientcontainer");i.prototype=Object.create(r.prototype),t.exports=i},{"./gradientcontainer":9}],28:[function(e,t,n){function r(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.onload=function(){r.status===200?t(r.responseText):n(new Error(r.statusText))},r.onerror=function(){n(new Error("Network Error"))},r.send()})}t.exports=r},{}]},{},[4])(4)}),define("lib/editor4screen",["lib/html2canvas"],function(e){var t=function(){var e=document.createElement("div"),t=null,n=this;e.style.position="fixed",e.style.height=window.innerHeight+"px",e.style.width=window.innerWidth+"px",e.style.left=0,e.style.top=0,e.style.zIndex=2147483550,e.style.cursor="cell";var r=[],i,s;for(var o=0;o<4;o++){var u=document.createElement("div");e.appendChild(u),r.push(u),u.style.position="fixed",u.style.backgroundColor="#AAA",u.style.opacity=.2,u.style.top="0px",u.style.right="0px",u.style.bottom="0px",u.style.left="0px",u.style.height=window.innerHeight+"px",o&&(u.style.width="0px")}var a=document.createElement("div");a.innerHTML='<div class="image-editor-selection-border-top"></div><div class="image-editor-selection-border-bottom"></div><div class="image-editor-selection-border-left"></div><div class="image-editor-selection-border-right"></div><style>.image-editor-selection-border-bottom,.image-editor-selection-border-top{position:absolute;left:0;right:0;height:1px;background-image:url("data:image/gif;base64,R0lGODlhBgABAKEAAP///wAAADY2Nv///yH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQACgD/ACwAAAAABgABAAACAxQuUgAh+QQBCgADACwAAAAABgABAAACA5SAUgAh+QQBCgADACwAAAAABgABAAACA5SBBQAh+QQBCgADACwAAAAABgABAAACA4QOUAAh+QQBCgADACwAAAAABgABAAACAwSEUAAh+QQBCgADACwAAAAABgABAAACA4SFBQA7");z-index:1}.image-editor-selection-border-top{top:0}.image-editor-selection-border-bottom{bottom:0}.image-editor-selection-border-left,.image-editor-selection-border-right{position:absolute;top:0;bottom:0;width:1px;background-image:url("data:image/gif;base64,R0lGODlhAQAGAKEAAP///wAAADY2Nv///yH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQACgD/ACwAAAAAAQAGAAACAxQuUgAh+QQBCgADACwAAAAAAQAGAAACA5SAUgAh+QQBCgADACwAAAAAAQAGAAACA5SBBQAh+QQBCgADACwAAAAAAQAGAAACA4QOUAAh+QQBCgADACwAAAAAAQAGAAACAwSEUAAh+QQBCgADACwAAAAAAQAGAAACA4SFBQA7");z-index:1}.image-editor-selection-border-left{left:0}.image-editor-selection-border-right{right:0}.resizable-handle{position:absolute;width:6px;height:6px;border:1px solid #000;box-shadow:1px 1px 0 hsla(0,0%,100%,.6),inset 1px 1px 0 hsla(0,0%,100%,.6)}.resizable-nw{cursor:nw-resize;left:1px;top:1px}.resizable-ne{cursor:ne-resize;right:1px;top:1px}.resizable-sw{bottom:1px;cursor:sw-resize;left:1px}.resizable-se{bottom:1px;cursor:se-resize;right:1px}.resizable-n{cursor:n-resize;left:50%;margin-left:-3px;top:1px}.resizable-s{bottom:1px;cursor:s-resize;left:50%;margin-left:-3px}.resizable-w{cursor:w-resize;left:1px;margin-top:-3px;top:50%}.resizable-e{cursor:e-resize;margin-top:-3px;right:1px;top:50%}</style>',e.appendChild(a),r.push(a),a.style.position="fixed",a.style.top="0px",a.style.right="0px",a.style.bottom="0px",a.style.left="0px",a.style.width="0px",a.style.height="0px";var f=function(){if(!i||!s)return!1;var e=Math.min(i.y,s.y),t=Math.max(i.x,s.x),n=Math.max(i.y,s.y),o=Math.min(i.x,s.x);r[0].style.bottom=window.innerHeight-e+"px",r[0].style.height=e+"px",r[0].style.width=window.innerWidth+"px",r[1].style.left=t+"px",r[1].style.width=window.innerWidth-t+"px",r[1].style.top=e+"px",r[1].style.height=n-e+"px",r[2].style.top=n+"px",r[2].style.height=window.innerHeight-n+"px",r[2].style.width=window.innerWidth+"px",r[3].style.right=window.innerWidth-o+"px",r[3].style.width=o+"px",r[3].style.top=e+"px",r[3].style.height=n-e+"px",a.style.top=e-1+"px",a.style.left=o-1+"px",a.style.height=n-e+2+"px",a.style.width=t-o+2+"px"},l=function(e){s={x:e.clientX,y:e.clientY},f(i,s)};e.addEventListener("mousedown",function(t){i={x:t.clientX,y:t.clientY},f(),e.addEventListener("mousemove",l)});var c=function(n){if(!i)return!1;s={x:n.clientX,y:n.clientY},f(),e.removeEventListener("mousemove",l),typeof t=="function"&&t()};e.addEventListener("mouseup",c),document.body.addEventListener("mouseout",function(e){(e.clientX<5||e.clientY<5||window.innerWidth-e.clientX<5||window.innerHeight-e.clientY<5)&&c(e)}),this.show=function(r){document.body.appendChild(e),t=function(){typeof r=="function"&&r(i,s),n.hide()}},this.hide=function(){document.body.removeChild(e),t=null,i=null,s=null;try{e.removeEventListener("mousemove",l)}catch(n){}}},n=document.createElement("div");n.style.position="fixed",n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px",n.style.opacity=.9,n.style.zIndex=2147483550,n.style.top=0,n.style.left=0,n.style.backgroundColor="#AAA",n.innerHTML='<div style="text-align: center;margin-top:50%;">正在截图, 请稍后...</div>',n.style.display="none",n.display=function(){n.style.display="block"},n.hide=function(){n.style.display="none"},document.body.appendChild(n);var r=document.createElement("iframe"),i=document.createElement("dialog");i.style.border="0",i.style.padding="0",r.src="about:blank",r.addEventListener("load",function(){r.contentWindow.document.body.appendChild(i)}),r.style.display="none",r.style.position="fixed",r.style.left=0,r.style.right=0,r.style.margin="0 auto",r.style.zIndex=2147483567,r.style.top="5%",r.style.border="0",document.body.appendChild(r),i.style.textAlign="center";var s=1,o=null,u=null,a=null,f=null,l=[];i.className="editor4screen",i.style.position="fixed",i.style.left=0,i.style.right=0,i.style.margin="0 auto",typeof i.show=="function"&&i.show(),i.display=function(){n.querySelector("div").style.display="none",n.display(),i.style.width="auto",r.style.display="block",i.style.width=Math.max(Math.ceil(c.width*s),200)+"px",r.style.width=parseInt(i.style.width)+20+"px",r.style.height=i.offsetHeight+20+"px",o=null,u=null,a=null,f=null},i.hide=function(){n.querySelector("div").style.display="",n.hide(),r.style.display="none",o=null,u=null,a=null,f=null},i.innerHTML='<h4>截图</h4><canvas></canvas><div><nav style="float:right;margin-top:1em;border: 1px solid;width:170px; height:28px;"></nav></div>';var c=i.querySelector("canvas"),h=null,p=function(e){var t={x:e.offsetLeft,y:e.offsetTop},n=e.offsetParent;while(n!==null)t.x+=n.offsetLeft,t.y+=n.offsetTop,n=n.offsetParent;return t},d=!!navigator.userAgent.toUpperCase().match(/MSIE|TRIDENT/),v=!!navigator.userAgent.toUpperCase().match(/EDGE/),m=!!navigator.userAgent.toUpperCase().match(/FIREFOX/),g=function(e){if(d||v||m){var t=p(e.target);return{x:(e.pageX-t.x)/s,y:(e.pageY-t.y)/s}}return{x:e.offsetX/s,y:e.offsetY/s}},y=function(e){return e||(e=document.createElement("canvas"),e.width=c.width,e.height=c.height,e.getContext("2d").drawImage(c,0,0)),l.push(c),i.replaceChild(e,c),c=e,s=Math.min(window.innerWidth/c.width,window.innerHeight/c.height),s<1.3?s=.7:s<2?s=1:s*=.7,m&&(s=1),c.style.zoom=s,c.addEventListener("click",function(e){typeof o=="function"&&o(e)}),c.addEventListener("mousedown",function(e){typeof u=="function"&&u(e)}),c.addEventListener("mouseup",function(e){typeof a=="function"&&a(e)}),c.addEventListener("mousemove",function(e){typeof f=="function"&&f(e)}),c.oncontextmenu=function(){return!1},c},b=function(){if(l.length){var e=l.pop();return e.style.cursor=c.style.cursor,i.replaceChild(e,c),c=e,c}return null},w=function(e){var t=document.createElement("a");return t.href="javascript:void(0)",t.title=e,t.innerHTML='<span style="display: inline-block;width: 34px;height: 28px;line-height: 15px;text-align: center;color: #000;"></span>',t},E=i.querySelector("nav");require.version?E.style.backgroundImage="url("+location.protocol+"//im.usingnet.com/src/v2/image/cuttoolbar.png)":E.style.backgroundImage="url("+location.protocol+"//im.usingnet.com/build/v2/image/cuttoolbar.png)";var S=w("文字");S.addEventListener("click",function(){c.style.cursor="text",u=null,a=null,f=null,o=function(e){var t=g(e),n=y().getContext("2d");c.style.cursor="text",n.font=Math.max(Math.ceil(30/s),12)+"px Courier New",n.lineWidth=2,n.strokeStyle="red";var r=document.createElement("textarea");r.style.position="fixed",r.style.zIndex=99999,d?(r.style.left=e.clientX+"px",r.style.top=e.clientY+"px"):(r.style.left=Math.ceil(e.clientX/s)+"px",r.style.top=Math.ceil(e.clientY/s)+"px"),r.style.height=Math.min(40,c.height-t.y)+"px",r.style.width=Math.min(120,c.width-t.x)+"px",r.style.fontSize=Math.ceil(30/s)+"px",m?r.style.transform="scale("+s+")":r.style.zoom=s,r.style.fontFamily="Courier New",r.style.color="red",i.appendChild(r),r.focus(),r.addEventListener("keypress",function(e){(e.keyCode==13||e.keyCode==10)&&!e.crtlKey&&r.blur()}),r.addEventListener("blur",function(){var e=r.value;i.removeChild(r),e?n.strokeText(e,t.x,t.y+15):b()})}});var x=w("笔刷");x.addEventListener("click",function(){c.style.cursor="cell";var e=null,t=null;o=null,u=function(n){t=g(n),e=y().getContext("2d"),c.style.cursor="cell",e.lineWidth=2,e.strokeStyle="red"},f=function(n){t&&(e.beginPath(),e.moveTo(t.x,t.y),t=g(n),e.lineTo(t.x,t.y),e.stroke())},a=function(e){t=null}});var T=w("撤销");T.addEventListener("click",function(){b()});var N=w("确定");N.addEventListener("click",function(){var e=c.toDataURL("image/png");e&&typeof h=="function"&&h(e),i.hide()});var C=w("取消");return C.addEventListener("click",function(){i.hide()}),E.appendChild(S),E.appendChild(x),E.appendChild(T),E.appendChild(N),E.appendChild(C),function(r,s){var o=new t;o.show(function(t,o){if(!t||!o)return!1;h=s;var u=Math.min(t.y,o.y),a=Math.min(t.x,o.x),f=Math.max(t.x,o.x)-a,c=Math.max(t.y,o.y)-u;e(r,{useCORS:!1,proxy:"http://app.usingnet.com/api/proxy/image",rectangle:{top:u+document.body.scrollTop,right:a+f+document.body.scrollLeft,bottom:u+c+document.body.scrollTop,left:a+document.body.scrollLeft}}).then(function(e){var t=document.createElement("canvas");f*c>4?(t.width=f,t.height=c,t.getContext("2d").drawImage(e,a,u,f,c,0,0,f,c),y(t),l=[],i.display()):n.hide()}),n.display()})}}),define("text!view/page/error/Error.html",[],function(){return'<!-- <dialog> -->\n    <h4><# echo $title; #><span class="fa fa-times pull-right" onclick="document.body.removeChild(this.parentElement.parentElement)"></span></h4>\n    <details>\n        <summary>\n            <# echo $summary; #>\n        </summary>\n        <# echo $detail; #>\n    </details>\n<!-- </dialog> -->'}),define("view/page/error/Error",["lib/class","lib/template","text!./Error.html"],function(e,t,n){var r=document.createElement("dialog");return new((new e).extend(function(){this.show=function(e,i,s,o){typeof o=="undefined"&&(o=3e3),r.innerHTML=t(n,{title:e,summary:i,detail:s}),document.body.appendChild(r),typeof r.show=="function"&&r.show();if(o>0){var u=this;setTimeout(function(){u.hide()},o)}},this.hide=function(){typeof r.close=="function"&&r.close(),r&&document.body.removeChild(r)}}))}),define("view/messagebubble/MessageBubble",["lib/class"],function(e){return new((new e).extend(function(){var e=document.createElement("div");e.style.padding="10px",e.style.zIndex="9999999",e.style.position="absolute",e.style.top="9em",e.style.border="1px solid #f5f5f5",e.style.boxShadow="0 0 0 2px #f5f5f5",e.style.borderRadius="5px",e.style.display="none",document.body.appendChild(e),this.showError=function(t,n){typeof n=="undefined"&&(n=5),e.style.display="block",e.innerHTML=t,e.style.background="#000",e.style.color="#fff",e.style.opacity=.6,e.style.maxWidth=document.body.offsetWidth/3*2+"px",e.style.left=document.body.offsetWidth/2-e.offsetWidth/2+"px",typeof n=="number"&&setTimeout(function(){e.style.display="none"},n*1e3)},this.showSuccess=function(t,n){typeof n=="undefined"&&(n=5),e.style.display="block",e.innerHTML=t,e.style.background="#FCE0BA",e.style.opacity=1,e.style.color="#000",e.style.maxWidth=document.body.offsetWidth/3*2+"px",e.style.left=document.body.offsetWidth/2-e.offsetWidth/2+"px",typeof n=="number"&&setTimeout(function(){e.style.display="none"},n*1e3)}}))}),define("view/im/messageform/tools/CutScreen",["lib/class","lib/editor4screen","lib/ajax","view/page/error/Error","view/messagebubble/MessageBubble"],function(e,t,n,r,i){return(new e).extend(function(e,r){var s=document.createElement("a");return s.className="pure-button tools-button",s.href="javascript:void(0)",s.title="截屏",s.innerHTML='<span class="fa fa-crop"></span>',s.addEventListener("click",function(){self!=top?window.parent.postMessage(JSON.stringify({action:"cutScreen"}),"*"):t(document.body,function(e){window.postMessage(JSON.stringify({data:e,type:"image/png",encode:"base64",action:"sendScreen"}),"*")})}),window.addEventListener("message",function(e){try{var t=JSON.parse(e.data);if(t&&t.action=="sendScreen"&&t.data){var s=Math.ceil(t.data.length/1024);if(s>10240){i.showError("截图过大，只能发送10M以内的截图!");return}n.post("/api/upload",{file:t.data,type:t.type,encode:t.encode},function(e){e.success?r.send(e.data):i.showError(e.msg?e.msg:"上传截图时发生错误。",5)})}}catch(e){}}),s})}),define("text!view/im/messageform/tools/Face.html",[],function(){return"<table class=\"face-table\">\n    <tbody>\n    <# for($i=0;$i<8;$i++){ #>\n    <tr>\n        <# for($j=0;$j<13;$j++){ #>\n        <td data=\"<# echo '['+$faceListMap.qq[$i*8+$j]+']'; #>\"><# echo $textToHtml('['+$faceListMap.qq[$i*8+$j]+']'); #></td>\n        <# } #>\n    </tr>\n    <# } #>\n    </tbody>\n</table>\n\n<style>\n    table.face-table td{\n        width: 27px;\n        height: 27px;\n        border: 1px solid #DDD;\n        text-align: center;\n        vertical-align: middle;\n        cursor: pointer;\n    }\n</style>\n"}),define("view/im/messageform/tools/Face",["lib/class","lib/face","text!./Face.html","lib/template"],function(e,t,n,r){return(new e).extend(function(e,i){var s=document.createElement("a"),o=document.createElement("div");return o.style.position="fixed",o.style.zIndex=999999,o.style.backgroundColor="#FFF",o.style.left="3px",o.style.bottom="40px",o.style.display="none",document.body.appendChild(o),s.className="pure-button tools-button",s.href="javascript:void(0)",s.title="表情",s.innerHTML='<span class="fa fa-smile-o"></span>',o.innerHTML=r(n,t),o.addEventListener("click",function(t){var n=t.target;n.tagName!="TD"&&(n=n.parentElement),n&&n.getAttribute("data")&&(e.value+=n.getAttribute("data"),e.focus())}),s.addEventListener("click",function(e){o.style.display=o.style.display=="none"?"block":"none",e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),document.body.addEventListener("click",function(){o.style.display="none"}),s})}),define("text!view/im/messageform/tools/UploadImage.html",[],function(){return'<iframe name="im_plugin_upload_iframe" src="about:blank" style="display: none"></iframe>\n<span style="height: 35px; line-height: 35px; " class="fa fa-image"></span>\n<form action="/api/upload" method="post" enctype="multipart/form-data" target="im_plugin_upload_iframe">\n    <input style="height: 35px;width: 46px;margin-left: -35px;opacity: 0.01; cursor:hand; font-size:40px; margin-top:10px;" type="file" name="file" />\n    <input type="reset" name="reset" style="display: none;" />\n</form>'}),define("view/im/messageform/tools/UploadImage",["lib/class","text!./UploadImage.html","view/page/error/Error","view/messagebubble/MessageBubble"],function(e,t,n,r){return(new e).extend(function(e,n){var i=document.createElement("span");i.style.padding="0",i.style.width="46px",i.style.height="35px",i.className="pure-button tools-button",i.href="javascript:void(0)",i.title="上传图片",i.innerHTML=t,i.style.overflow="hidden";var s=i.querySelector("form"),o=i.querySelector("iframe"),u=i.querySelector('input[type="reset"]'),a=i.querySelector('input[type="file"]');return a.addEventListener("change",function(){var e=Math.ceil(a.files[0].size/1024);if(e>4096){r.showError("文件过大，只能发送10M以内的图片!");try{u.click()}catch(t){var n=document.createEvent("MouseEvents");n.initEvent("click",!0,!0),u.dispatchEvent(n)}return}s.submit()}),s.style.marginTop="-45px",s.style.marginLeft="35px",o.addEventListener("load",function(e){if(o.contentWindow.location.href!="about:blank"&&(!o.readyState||o.readyState=="complete"))try{var t=JSON.parse(o.contentDocument.body.innerText||o.contentDocument.body.innerHTML);if(t.success){n.send(t.data);try{u.click()}catch(i){var s=document.createEvent("MouseEvents");s.initEvent("click",!0,!0),u.dispatchEvent(s)}}else r.showError(t.msg?t.msg:"服务器错误。",10)}catch(i){r.showError("上传文件失败，请稍后重试",5)}}),i})}),define("text!view/im/messageform/tools/Evaluate.html",[],function(){return'<div class="evaluation-header">\n    <div>欢迎对我的服务进行评价：</div>\n    <a class="evaluation-hide">\n        <i style="color: #666; font-size: 20px" class="fa fa-times"></i>\n    </a>\n</div>\n<div class="evaluation-body">\n    <div class="evaluation-btn">\n        <input id="evaluationLevel" type="hidden">\n        <div data-level="GOOD">\n            <i class="icon icon-good"></i>\n            <span>好评</span>\n        </div>\n        <div data-level="GENERAL">\n            <i class="icon icon-general"></i>\n            <span>中评</span>\n        </div>\n        <div data-level="BAD">\n            <i class="icon icon-bad"></i>\n            <span>差评</span>\n        </div>\n    </div>\n    <textarea id="evaluationContent" placeholder="请填写评价内容（选填）"></textarea>\n    <button class="evaluation-submit">提交</button>\n</div>\n'}),define("view/im/messageform/tools/Evaluate",["lib/class","text!./Evaluate.html","lib/ajax","view/messagebubble/MessageBubble"],function(e,t,n,r){return(new e).extend(function(e,i){var s=document.createElement("a");return s.className="pure-button tools-button",s.href="javascript:void(0)",s.title="评价",s.id="evaluationButton",s.innerHTML='<span class="fa fa-thumbs-up"></span><input id="evaluationAgent" type="hidden">',s.addEventListener("click",function(e){if(document.querySelector("#evaluationDiv"))return;var i=document.querySelector("article"),s=document.querySelector("footer"),o=document.createElement("div");o.id="evaluationDiv",o.style.background="#FAFAFA",o.style.position="absolute",o.style.top="3em",o.style.bottom="8em",o.style.zIndex=999999,o.innerHTML=t,o.style.width=i.offsetWidth+"px",o.style.height=i.offsetHeight+s.offsetHeight+"px";var u=o.querySelector(".evaluation-hide");u.addEventListener("click",function(e){document.body.removeChild(o)});var a=o.querySelectorAll(".evaluation-btn div"),f=o.querySelector("#evaluationLevel");for(var l=0;l<a.length;l++)a[l].addEventListener("click",function(e){var t=this;f.value=t.getAttribute("data-level");for(var n=0;n<a.length;n++)a[n].className="";t.className="evaluation-select"});var c=o.querySelector("button.evaluation-submit"),h=o.querySelector("#evaluationContent");c.addEventListener("click",function(e){var t=document.getElementById("evaluationAgent").value,i=f.value,s=h.value;if(!t||!i){r.showError(t?"请选择评价。":"对话开始后才能进行评价。",3);return}n.post("api/evaluation",{order_id:t,level:i,content:s},function(e){e.success?(r.showSuccess("评价成功！",3),document.body.removeChild(o)):r.showSuccess(e.msg?e.msg:"服务器错误，评价失败，请联系客服人员处理。",3)})}),document.body.appendChild(o)}),s})}),define("view/im/messageform/MessageForm",["lib/class","text!./MessageForm.html","./tools/CutScreen","./tools/Face","./tools/UploadImage","./tools/Evaluate","lib/browser","view/messagebubble/MessageBubble"],function(e,t,n,r,i,s,o,u){var a=document.createElement("footer");a.className="pure-form",a.innerHTML=t;var f=null,l=a.querySelector(".sendBtn"),c=a.querySelector("textarea"),h=a.querySelector("nav"),p=!1;return c.addEventListener("keyup",function(){p||(p=!0,setTimeout(function(){p=!1,f&&f.typing(c.value)},1e3))}),(new e).extend(function(){this.appendTo=function(e){e.appendChild(a)},this.setConfig=function(e){if(!e||!e.web)return!1;c.placeholder=e.web.input_placeholder||"有什么可以帮您?"},this.setMessager=function(e){f||(f=e,c.addEventListener("keypress",function(e){if((e.keyCode==13||e.keyCode==10)&&!e.ctrlKey&&!e.shiftKey){try{l.click()}catch(e){var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),l.dispatchEvent(t)}return typeof e.preventDefault=="function"&&e.preventDefault(),!1}}),f.addEventListener("error",function(e){u.showError(e.data?e.data:"服务器内部错误。",5),c.value=e.value}),l.addEventListener("click",function(){c.value&&(f.send(c.value),c.value=""),c.focus()}),h.appendChild(new r(c,f)),o.isMobile||h.appendChild(new n(c,f)),h.appendChild(new i(c,f)),h.appendChild(new s(c,f)))}})}),define("lib/event",[],function(){return function(e){typeof Event=="undefined"?this.prototype={}:Event.constructor?this.prototype=Event.constructor():this.prototype=Event.create(e),this.type=e}});var swfobject=function(){function C(){if(b)return;try{var e=a.getElementsByTagName("body")[0].appendChild(U("span"));e.parentNode.removeChild(e)}catch(t){return}b=!0;var n=c.length;for(var r=0;r<n;r++)c[r]()}function k(e){b?e():c[c.length]=e}function L(t){if(typeof u.addEventListener!=e)u.addEventListener("load",t,!1);else if(typeof a.addEventListener!=e)a.addEventListener("load",t,!1);else if(typeof u.attachEvent!=e)z(u,"onload",t);else if(typeof u.onload=="function"){var n=u.onload;u.onload=function(){n(),t()}}else u.onload=t}function A(){l?O():M()}function O(){var n=a.getElementsByTagName("body")[0],r=U(t);r.setAttribute("type",i);var s=n.appendChild(r);if(s){var o=0;(function(){if(typeof s.GetVariable!=e){var t=s.GetVariable("$version");t&&(t=t.split(" ")[1].split(","),T.pv=[parseInt(t[0],10),parseInt(t[1],10),parseInt(t[2],10)])}else if(o<10){o++,setTimeout(arguments.callee,10);return}n.removeChild(r),s=null,M()})()}else M()}function M(){var t=h.length;if(t>0)for(var n=0;n<t;n++){var r=h[n].id,i=h[n].callbackFn,s={success:!1,id:r};if(T.pv[0]>0){var o=R(r);if(o)if(W(h[n].swfVersion)&&!(T.wk&&T.wk<312))V(r,!0),i&&(s.success=!0,s.ref=_(r),i(s));else if(h[n].expressInstall&&D()){var u={};u.data=h[n].expressInstall,u.width=o.getAttribute("width")||"0",u.height=o.getAttribute("height")||"0",o.getAttribute("class")&&(u.styleclass=o.getAttribute("class")),o.getAttribute("align")&&(u.align=o.getAttribute("align"));var a={},f=o.getElementsByTagName("param"),l=f.length;for(var c=0;c<l;c++)f[c].getAttribute("name").toLowerCase()!="movie"&&(a[f[c].getAttribute("name")]=f[c].getAttribute("value"));P(u,a,r,i)}else H(o),i&&i(s)}else{V(r,!0);if(i){var p=_(r);p&&typeof p.SetVariable!=e&&(s.success=!0,s.ref=p),i(s)}}}}function _(n){var r=null,i=R(n);if(i&&i.nodeName=="OBJECT")if(typeof i.SetVariable!=e)r=i;else{var s=i.getElementsByTagName(t)[0];s&&(r=s)}return r}function D(){return!w&&W("6.0.65")&&(T.win||T.mac)&&!(T.wk&&T.wk<312)}function P(t,n,r,i){w=!0,g=i||null,y={success:!1,id:r};var o=R(r);if(o){o.nodeName=="OBJECT"?(v=B(o),m=null):(v=o,m=r),t.id=s;if(typeof t.width==e||!/%$/.test(t.width)&&parseInt(t.width,10)<310)t.width="310";if(typeof t.height==e||!/%$/.test(t.height)&&parseInt(t.height,10)<137)t.height="137";a.title=a.title.slice(0,47)+" - Flash Player Installation";var f=T.ie&&T.win?"ActiveX":"PlugIn",l="MMredirectURL="+u.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+a.title;typeof n.flashvars!=e?n.flashvars+="&"+l:n.flashvars=l;if(T.ie&&T.win&&o.readyState!=4){var c=U("div");r+="SWFObjectNew",c.setAttribute("id",r),o.parentNode.insertBefore(c,o),o.style.display="none",function(){o.readyState==4?o.parentNode.removeChild(o):setTimeout(arguments.callee,10)}()}j(t,n,r)}}function H(e){if(T.ie&&T.win&&e.readyState!=4){var t=U("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(B(e),t),e.style.display="none",function(){e.readyState==4?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(B(e),e)}function B(e){var n=U("div");if(T.win&&T.ie)n.innerHTML=e.innerHTML;else{var r=e.getElementsByTagName(t)[0];if(r){var i=r.childNodes;if(i){var s=i.length;for(var o=0;o<s;o++)(i[o].nodeType!=1||i[o].nodeName!="PARAM")&&i[o].nodeType!=8&&n.appendChild(i[o].cloneNode(!0))}}}return n}function j(n,r,s){var o,u=R(s);if(T.wk&&T.wk<312)return o;if(u){typeof n.id==e&&(n.id=s);if(T.ie&&T.win){var a="";for(var f in n)n[f]!=Object.prototype[f]&&(f.toLowerCase()=="data"?r.movie=n[f]:f.toLowerCase()=="styleclass"?a+=' class="'+n[f]+'"':f.toLowerCase()!="classid"&&(a+=" "+f+'="'+n[f]+'"'));var l="";for(var c in r)r[c]!=Object.prototype[c]&&(l+='<param name="'+c+'" value="'+r[c]+'" />');u.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+l+"</object>",p[p.length]=n.id,o=R(n.id)}else{var h=U(t);h.setAttribute("type",i);for(var d in n)n[d]!=Object.prototype[d]&&(d.toLowerCase()=="styleclass"?h.setAttribute("class",n[d]):d.toLowerCase()!="classid"&&h.setAttribute(d,n[d]));for(var v in r)r[v]!=Object.prototype[v]&&v.toLowerCase()!="movie"&&F(h,v,r[v]);u.parentNode.replaceChild(h,u),o=h}}return o}function F(e,t,n){var r=U("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function I(e){var t=R(e);t&&t.nodeName=="OBJECT"&&(T.ie&&T.win?(t.style.display="none",function(){t.readyState==4?q(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function q(e){var t=R(e);if(t){for(var n in t)typeof t[n]=="function"&&(t[n]=null);t.parentNode.removeChild(t)}}function R(e){var t=null;try{t=a.getElementById(e)}catch(n){}return t}function U(e){return a.createElement(e)}function z(e,t,n){e.attachEvent(t,n),d[d.length]=[e,t,n]}function W(e){var t=T.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function X(n,r,i,s){if(T.ie&&T.mac)return;var o=a.getElementsByTagName("head")[0];if(!o)return;var u=i&&typeof i=="string"?i:"screen";s&&(E=null,S=null);if(!E||S!=u){var f=U("style");f.setAttribute("type","text/css"),f.setAttribute("media",u),E=o.appendChild(f),T.ie&&T.win&&typeof a.styleSheets!=e&&a.styleSheets.length>0&&(E=a.styleSheets[a.styleSheets.length-1]),S=u}T.ie&&T.win?E&&typeof E.addRule==t&&E.addRule(n,r):E&&typeof a.createTextNode!=e&&E.appendChild(a.createTextNode(n+" {"+r+"}"))}function V(e,t){if(!x)return;var n=t?"visible":"hidden";b&&R(e)?R(e).style.visibility=n:X("#"+e,"visibility:"+n)}function $(t){var n=/[\\\"<>\.;]/,r=n.exec(t)!=null;return r&&typeof encodeURIComponent!=e?encodeURIComponent(t):t}var e="undefined",t="object",n="Shockwave Flash",r="ShockwaveFlash.ShockwaveFlash",i="application/x-shockwave-flash",s="SWFObjectExprInst",o="onreadystatechange",u=window,a=document,f=navigator,l=!1,c=[A],h=[],p=[],d=[],v,m,g,y,b=!1,w=!1,E,S,x=!0,T=function(){var s=typeof a.getElementById!=e&&typeof a.getElementsByTagName!=e&&typeof a.createElement!=e,o=f.userAgent.toLowerCase(),c=f.platform.toLowerCase(),h=c?/win/.test(c):/win/.test(o),p=c?/mac/.test(c):/mac/.test(o),d=/webkit/.test(o)?parseFloat(o.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,v=!1,m=[0,0,0],g=null;if(typeof f.plugins!=e&&typeof f.plugins[n]==t)g=f.plugins[n].description,g&&(typeof f.mimeTypes==e||!f.mimeTypes[i]||!!f.mimeTypes[i].enabledPlugin)&&(l=!0,v=!1,g=g.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),m[0]=parseInt(g.replace(/^(.*)\..*$/,"$1"),10),m[1]=parseInt(g.replace(/^.*\.(.*)\s.*$/,"$1"),10),m[2]=/[a-zA-Z]/.test(g)?parseInt(g.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof u.ActiveXObject!=e)try{var y=new ActiveXObject(r);y&&(g=y.GetVariable("$version"),g&&(v=!0,g=g.split(" ")[1].split(","),m=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)]))}catch(b){}return{w3:s,pv:m,wk:d,ie:v,win:h,mac:p}}(),N=function(){if(!T.w3)return;(typeof a.readyState!=e&&a.readyState=="complete"||typeof a.readyState==e&&(a.getElementsByTagName("body")[0]||a.body))&&C(),b||(typeof a.addEventListener!=e&&a.addEventListener("DOMContentLoaded",C,!1),T.ie&&T.win&&(a.attachEvent(o,function(){a.readyState=="complete"&&(a.detachEvent(o,arguments.callee),C())}),u==top&&function(){if(b)return;try{a.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}C()}()),T.wk&&function(){if(b)return;if(!/loaded|complete/.test(a.readyState)){setTimeout(arguments.callee,0);return}C()}(),L(C))}(),J=function(){T.ie&&T.win&&window.attachEvent("onunload",function(){var e=d.length;for(var t=0;t<e;t++)d[t][0].detachEvent(d[t][1],d[t][2]);var n=p.length;for(var r=0;r<n;r++)I(p[r]);for(var i in T)T[i]=null;T=null;for(var s in swfobject)swfobject[s]=null;swfobject=null})}();return{registerObject:function(e,t,n,r){if(T.w3&&e&&t){var i={};i.id=e,i.swfVersion=t,i.expressInstall=n,i.callbackFn=r,h[h.length]=i,V(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){if(T.w3)return _(e)},embedSWF:function(n,r,i,s,o,u,a,f,l,c){var h={success:!1,id:r};T.w3&&!(T.wk&&T.wk<312)&&n&&r&&i&&s&&o?(V(r,!1),k(function(){i+="",s+="";var p={};if(l&&typeof l===t)for(var d in l)p[d]=l[d];p.data=n,p.width=i,p.height=s;var v={};if(f&&typeof f===t)for(var m in f)v[m]=f[m];if(a&&typeof a===t)for(var g in a)typeof v.flashvars!=e?v.flashvars+="&"+g+"="+a[g]:v.flashvars=g+"="+a[g];if(W(o)){var y=j(p,v,r);p.id==r&&V(r,!0),h.success=!0,h.ref=y}else{if(u&&D()){p.data=u,P(p,v,r,c);return}V(r,!0)}c&&c(h)})):c&&c(h)},switchOffAutoHideShow:function(){x=!1},ua:T,getFlashPlayerVersion:function(){return{major:T.pv[0],minor:T.pv[1],release:T.pv[2]}},hasFlashPlayerVersion:W,createSWF:function(e,t,n){return T.w3?j(e,t,n):undefined},showExpressInstall:function(e,t,n,r){T.w3&&D()&&P(e,t,n,r)},removeSWF:function(e){T.w3&&I(e)},createCSS:function(e,t,n,r){T.w3&&X(e,t,n,r)},addDomLoadEvent:k,addLoadEvent:L,getQueryParamValue:function(e){var t=a.location.search||a.location.hash;if(t){/\?/.test(t)&&(t=t.split("?")[1]);if(e==null)return $(t);var n=t.split("&");for(var r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return $(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(w){var e=R(s);e&&v&&(e.parentNode.replaceChild(v,e),m&&(V(m,!0),T.ie&&T.win&&(v.style.display="block")),g&&g(y)),w=!1}}}}();define("swfobject",function(){}),define("lib/mode/websocket-plugin",["swfobject"],function(){return{init:function(){if(!window.WEB_SOCKET_FORCE_FLASH){if(window.WebSocket)return;if(window.MozWebSocket){window.WebSocket=MozWebSocket;return}}window.WEB_SOCKET_SWF_LOCATION="/resources/websocket/WebSocketMain.swf";var e;window.WEB_SOCKET_LOGGER?e=WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?e=window.console:e={log:function(){},error:function(){}};if(swfobject.getFlashPlayerVersion().major<10){e.error("Flash Player >= 10.0.0 is required."),confirm("您的Internet Explorer浏览器安装的Flash Player版本过低或未安装Flash Player，无法查看本网页。请使用Chrome浏览器访问，或更新Flash Player。点击“是”前往安装Flash Player，点击“否”关闭此网页。")?location.href="https://get.adobe.com/flashplayer/":window.close();return}location.protocol=="file:"&&e.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),window.WebSocket=function(e,t,n,r,i){var s=this;s.__id=WebSocket.__nextId++,WebSocket.__instances[s.__id]=s,s.readyState=WebSocket.CONNECTING,s.bufferedAmount=0,s.__events={},t?typeof t=="string"&&(t=[t]):t=[],s.__createTask=setTimeout(function(){WebSocket.__addTask(function(){s.__createTask=null,WebSocket.__flash.create(s.__id,e,t,n||null,r||0,i||null)})},0)},WebSocket.prototype.send=function(e){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var t=WebSocket.__flash.send(this.__id,encodeURIComponent(e));return t<0?!0:(this.bufferedAmount+=t,!1)},WebSocket.prototype.close=function(){if(this.__createTask){clearTimeout(this.__createTask),this.__createTask=null,this.readyState=WebSocket.CLOSED;return}if(this.readyState==WebSocket.CLOSED||this.readyState==WebSocket.CLOSING)return;this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)},WebSocket.prototype.addEventListener=function(e,t,n){e in this.__events||(this.__events[e]=[]),this.__events[e].push(t)},WebSocket.prototype.removeEventListener=function(e,t,n){if(!(e in this.__events))return;var r=this.__events[e];for(var i=r.length-1;i>=0;--i)if(r[i]===t){r.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(e){var t=this.__events[e.type]||[];for(var n=0;n<t.length;++n)t[n](e);var r=this["on"+e.type];r&&r.apply(this,[e])},WebSocket.prototype.__handleEvent=function(e){"readyState"in e&&(this.readyState=e.readyState),"protocol"in e&&(this.protocol=e.protocol);var t;if(e.type=="open"||e.type=="error")t=this.__createSimpleEvent(e.type);else if(e.type=="close")t=this.__createSimpleEvent("close"),t.wasClean=e.wasClean?!0:!1,t.code=e.code,t.reason=e.reason;else{if(e.type!="message")throw"unknown event type: "+e.type;var n=decodeURIComponent(e.message);t=this.__createMessageEvent("message",n)}this.dispatchEvent(t)},WebSocket.prototype.__createSimpleEvent=function(e){if(document.createEvent&&window.Event){var t=document.createEvent("Event");return t.initEvent(e,!1,!1),t}return{type:e,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(e,t){if(window.MessageEvent&&typeof MessageEvent=="function"&&!window.opera)return new MessageEvent("message",{view:window,bubbles:!1,cancelable:!1,data:t});if(document.createEvent&&window.MessageEvent&&!window.opera){var n=document.createEvent("MessageEvent");return n.initMessageEvent("message",!1,!1,t,null,null,window,null),n}return{type:e,data:t,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__isFlashImplementation=!0,WebSocket.__initialized=!1,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(e){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(e)})},WebSocket.__initialize=function(){if(WebSocket.__initialized)return;WebSocket.__initialized=!0,WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation);if(!window.WEB_SOCKET_SWF_LOCATION){e.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");return}if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var t=RegExp.$1;location.host!=t&&e.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+t+"'). "+"See also 'How to host HTML file and SWF file in different domains' section "+"in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message "+"by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}var n=document.createElement("div");n.id="webSocketContainer",n.style.position="absolute",WebSocket.__isFlashLite()?(n.style.left="0px",n.style.top="0px"):(n.style.left="-100px",n.style.top="-100px");var r=document.createElement("div");r.id="webSocketFlash",n.appendChild(r),document.body.appendChild(n),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(t){t.success||e.error("[WebSocket] swfobject.embedSWF failed")})},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var e=0;e<WebSocket.__tasks.length;++e)WebSocket.__tasks[e]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{var t=WebSocket.__flash.receiveEvents();for(var n=0;n<t.length;++n)WebSocket.__instances[t[n].webSocketId].__handleEvent(t[n])}catch(r){e.error(r)}},0),!0},WebSocket.__log=function(t){e.log(decodeURIComponent(t))},WebSocket.__error=function(t){e.error(decodeURIComponent(t))},WebSocket.__addTask=function(e){WebSocket.__flash?e():WebSocket.__tasks.push(e)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var e=window.navigator.mimeTypes["application/x-shockwave-flash"];return!e||!e.enabledPlugin||!e.enabledPlugin.filename?!1:e.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})}}}),define("lib/mode/websocket",["../class","../event","./websocket-plugin"],function(e,t,n){function r(e){var t;if(typeof e=="object")if(e===null)t=null;else if(e instanceof Array){t=[];for(var n=0,i=e.length;n<i;n++)t.push(r(e[n]))}else{t={};for(var s in e)t[s]=r(e[s])}else t=e;return t}return(new e).extend(function(e){n.init();var i=this,s={action:"heartbeat"},o=e||null,u=null,a=null,f={},l=[],c=0,h=function(e){if(console&&typeof console.log=="function"){console.log("WebSocket Log: ",e);var n=new t("log");n.data=e,i.triggerEvent(n)}},p=function(){var e=(new Date).getTime();for(var n in f)if(f[n].timeout<e){var r=new t("timeout");f[n].callback.call(i,null,r),delete f[n]}};setInterval(p,1e3),this.setUrl=function(t){o=t,e=t},this.connect=function(e){return u?!1:(u=new WebSocket((e||o)+("&_="+Math.random())),u.addEventListener("open",function(){f={},a=setInterval(function(){i.send(s,function(e,t){t.type=="timeout"?(i.close(!0),setTimeout(function(){i.connect()},Math.pow(2,c)*1e3)):c=0},5e3)},2e4);var e=new t("open");i.triggerEvent(e);if(l.length)while(l.length)i.send.apply(i,l.shift())}),u.addEventListener("close",function(){a&&clearInterval(a);var e=new t("close");e.reconnect=!!u,i.triggerEvent(e),u&&(u=null,c++,setTimeout(function(){i.connect()},Math.pow(2,c)*1e3))}),u.addEventListener("error",function(e){h(e)}),u.addEventListener("message",function(e){var n=JSON.parse(e.data),r=null;if(!n.ok&&"Illegal Token"==n.error){r=new t("tokenerror"),i.triggerEvent(r);return}n&&n.message_id&&f[n.message_id]&&(f[n.message_id].callback.call(i,n,e),delete f[n.message_id]),r=new t("message"),r.data=n,i.triggerEvent(r)}),!0)},this.send=function(e,t,n){var i=r(e),s=(new Date).getTime()+Math.random();return t&&typeof t=="function"&&(f[s]={callback:t,timeout:(Math.max(n,0)||2e4)+(new Date).getTime()}),i.message_id=s,u&&u.readyState==WebSocket.OPEN?u.send(JSON.stringify(i)):l.push([e,t,n]),!0},this.close=function(e){if(typeof e=="undefined"||!e)e=!1;a&&(clearInterval(a),a=null);if(u)if(e)u.close();else{var t=u;u=null,t.close()}return!0}})}),define("lib/cookie",[],function(){return{get:function(e,t){if(document.cookie.length>0){var n=document.cookie.indexOf(e+"=");if(n!=-1){n=n+e.length+1;var r=document.cookie.indexOf(";",n);r==-1&&(r=document.cookie.length),t(unescape(document.cookie.substring(n,r)));return}}t(null)},set:function(e,t){document.cookie=e+"="+escape(t)+"; path=/;"}}}),define("lib/messager",["lib/class","lib/mode/websocket","lib/ajax","lib/event","view/messagebubble/MessageBubble","lib/cookie"],function(e,t,n,r,i,s){return(new e).extend(function(e,o,u,a,f,l,c){var h=this,p=null,d="_usingnet_socket";typeof l=="undefined"&&(l="IM"),typeof f=="undefined"&&(f=null),this.typing=function(e){p&&p.send({action:"typing",message:e})},this.sendOrder=function(t,i){n.post("/api/message/client",{type:l,title:t,from:e,to:o,body:JSON.stringify(i),user_info:u},function(e){if(!e.success){var t=new r("error");t.data=e.msg,h.triggerEvent(t)}else{var t=new r("sent");t.data=e.data,h.triggerEvent(t)}})},this.send=function(t,i,s,a){typeof i=="undefined"&&(i=null),typeof s=="undefined"&&(s=null);var c=document.querySelector("#displayAgentGroup"),p=c&&c.getAttribute("data-id"),d={body:t,from:e,to:o,type:l,user_info:u,page_id:f,email:i,phone:s};p&&(d.group_id=p);if(a){n.post("/api/message/lm",d,function(e){if(!e.success){var t=new r("error");t.data=e.msg,h.triggerEvent(t)}else{var t=new r("sent");t.data=e.data,h.triggerEvent(t)}});return}n.post("/api/message/client",d,function(e){if(!e.success){var t=new r("error");t.data=e.msg,t.value=d.body,h.triggerEvent(t)}else{var t=new r("sent");t.data=e.data,h.triggerEvent(t);var n=document.querySelector("#displayAgentGroup");n&&(n.style.zIndex="-10000")}})};var v=function(a){a.success?(navigator&&navigator.appVersion&&navigator.appVersion.match("MQQBrowser")?p=new t("ws://ws.usingnet.com/ws?_token="+a.data):p=new t("wss://ws.usingnet.com/ws?_token="+a.data),p.connect(),p.send({action:"tail",read:!0}),p.addEventListener("message",function(t){if(p.isClose)return;if(t.data&&"message"===t.data.type&&t.data.data&&t.data.data["package"]){if(t.data.data["package"].action==="closed"){var i=document.querySelector("#evaluationButton");setTimeout(function(){i&&i.click()},2500)}t.data.data["package"].action==="invite"&&(c||n.get("/api/message/client",{from:e,to:o,type:"IM",user_info:u,_:Math.random()},function(e){e.success&&(s.set(d,e.data),p.send({action:"add_token",token:[e.data]}))}))}if(t.data&&"message"===t.data.type){var a={action:"newMessage",message:t.data.data.body};document.referrer&&window.parent.postMessage(JSON.stringify(a),document.referrer)}if(t.data&&"event"===t.data.type&&"notice"===t.data.data.action&&t.data.data.data){if("typing"===t.data.data.data.action){clearTimeout(h.timeoutId);var f=t.data.data.data.message,l=document.querySelector("header address i");l.innerText="客服正在输入中...",h.timeoutId=setTimeout(function(){l.innerText="正在为您服务"},800)}if(t.data.data.data.action=="undo"){var v=document.getElementById("message-"+t.data.data.data._id);v&&(v.className=(v.className?v.className+" ":"")+"gray",v.innerHTML="<div>[已撤销]</div>",setTimeout(function(){v.style.display="none"},1e3))}}var m=t.data.data;m.direction&&"SEND"===m.direction&&p.send({action:"read",_id:m._id});if(t.data){if("message"===t.data.type&&t.data.data["package"].order_id){var g=document.getElementById("evaluationAgent");g&&(g.value=t.data.data["package"].order_id)}var y=new r(t.data.type);y.data=t.data,h.triggerEvent(y)}}),p.addEventListener("tokenerror",function(){n.get("/api/message/client",{from:e,to:o,type:"IM",user_info:u,_:Math.random()},function(e){e.success&&(navigator&&navigator.appVersion&&navigator.appVersion.match("MQQBrowser")?p.setUrl("ws://ws.usingnet.com/ws?_token="+e.data):p.setUrl("wss://ws.usingnet.com/ws?_token="+e.data))})})):i.showError(a.msg?a.msg:"服务器内部错误。",5)};l=="IM"&&(window==parent&&!c?s.get(d,function(t){t||n.get("/api/message/client",{from:e,to:o,type:"IM",user_info:u,_:Math.random()},function(e){v(e)})}):c?v({success:!0,data:c}):s.get(d,function(e){v({success:!0,data:e?e:a.im_token})}))})}),define("view/im/Im",["lib/ajax","lib/class","../common/header/Header","./messagebox/MessageBox","./messageform/MessageForm","view/page/error/Error","lib/messager"],function(e,t,n,r,i,s,o){var u=new n,a=new r,f=new i;return(new t).extend(function(e,t,n,r,i,s){u.setConfig(i),f.setConfig(i);var l=new o(t,e,r,i,n,"IM",s);a.setMessager(l),f.setMessager(l),this.appendTo=function(e){u.appendTo(e),a.appendTo(e),f.appendTo(e)}})}),define("text!view/popup/PopUp.html",[],function(){return'<# if(($web[\'icon_shape\'] == \'none\' || $web[\'icon_shape\'] == \'custom\') && $web[\'customer_icon\']){ #>\n    <div id="__USINGNET_HOLDER" style="cursor: pointer;"><img src="<# echo $web[\'customer_icon\']; #>" alt="<# echo ($online || $web[\'type\'] == \'IM\') ? \'在线客服\' : \'客服留言\'; #>" /></div>\n<# }else{ #>\n    <# switch($web[\'icon_shape\']){ case \'bar\': #>\n        <div id="__USINGNET_HOLDER" style="cursor: pointer;box-shadow: rgba(0, 0, 0, 0.498039) 0 5px 10px;background: #<# echo $web[\'title_bg_color\']||"00A4F5"; #>; width:35px; height:140px;border-radius: 17px; padding-top: 17px;">\n            <img style="width:22px; height:20px; margin-left: 7px;" src="//im.usingnet.com/build/v2/image/message.png">\n            <p style="line-height: 20px; padding: 0 11px;text-indent: 0;margin-top: 6px;font-size: 13px; color:#FFF;"><# echo ($online || $web[\'type\'] == \'IM\') ?\'在线客服\':\'客服留言\'; #></p>\n        </div>\n        <# break; case \'square\': #>\n        <div id="__USINGNET_HOLDER" style="cursor: pointer;box-shadow: rgba(0, 0, 0, 0.498039) 0 5px 10px;background: #<# echo $web[\'title_bg_color\']||"00A4F5"; #>; width:58px; height:60px; ">\n            <img style="width:22px;height:20px;display: inline;margin: 10px 0 0 17px;" src="//im.usingnet.com/build/v2/image/message.png">\n            <p style="line-height: 20px; padding: 3px;text-indent: 2px;margin: 3px 0 0 0; font-size: 12px; color:#FFF;"><# echo ($online || $web[\'type\'] == \'IM\') ? \'在线客服\':\'客服留言\'; #></p>\n        </div>\n        <# break;  case \'circular\':default: #>\n        <div id="__USINGNET_HOLDER" style="cursor: pointer;box-shadow: rgba(0, 0, 0, 0.498039) 0 5px 10px;background: #<# echo $web[\'title_bg_color\']||"00A4F5"; #>; width:60px; height:60px; border-radius: 30px;">\n            <img style="width:22px;height:20px; display:inline;margin: 10px 0 0 17px;" src="//im.usingnet.com/build/v2/image/message.png">\n            <p style="line-height: 20px; margin-top: 2px;text-indent: 6px; font-size: 12px; color:#FFF;"><# echo ($online || $web[\'type\'] == \'IM\')  ?\'在线客服\':\'客服留言\'; #></p>\n        </div>\n        <# break;} #>\n<# } #>\n<div class="usingnetUnreadMessageRemind" style="display: none; width: 24px; height: 24px; border-radius: 50%; background: #FF4949; position: absolute; left: -12px; top: -12px; text-align: center; line-height: 24px; font-size: 14px; color: #fff;"></div>\n<iframe src="about:blank" style="border: 0;"></iframe>\n<div class="__youxinCopyright" style="border-top: 1px solid #EDEDED; display: none; color: rgb(203, 203, 203); text-align: center; line-height: 24px; height: 24px; background: rgb(244, 244, 244);">\n    <img src="//im.usingnet.com/build/v2/image/youxinlogo.png" style="height: 17px; display: inline-block; vertical-align: middle; -webkit-filter: grayscale(100%);">\n    <span style="display: inline-block; font-size: 12px;">客服软件由<a style="font-family: monospace; font-weight: bold; color: #C9C9C9;" target="_blank" href="http://www.usingnet.com">Usingnet</a>提供</span>\n</div>\n<style>\n    #usingnet_invite_container {\n        position: fixed;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        right: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 9999999999;\n        pointer-events: none;\n    }\n    #usingnet_invite_container > div {\n        position: relative;\n        cursor: pointer;\n        pointer-events: auto;\n    }\n    #usingnet_invite_container p {\n        position: absolute;\n        left: 90px;\n        top: 28px;\n        width: 230px;\n        height: 68px;\n        display: -webkit-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n        font-size: 16px;\n        overflow: hidden;\n        margin: 0;\n        padding: 0;\n        line-height: 32px;\n        color: #666;\n    }\n\n    #usingnet_invite_container .inviteClose {\n        position: absolute;\n        right: -8px;\n        top: -8px;\n        display: inline-block;\n        width: 32px;\n        height: 32px;\n        background: url("//im.usingnet.com/build/v2/image/invite-preview-close.png") no-repeat;\n        cursor: pointer;\n    }\n</style>'}),define("text!view/popup/PopUpMobile.html",[],function(){return'<div style="border-radius: 50%; width: 50px; height: 50px; box-shadow: rgba(0, 0, 0, 0.498039) 0 0 10px; background-color:#<# echo $web[\'title_bg_color\']||"00A4F5"; #>;color:#<# echo $web[\'title_txt_color\']||"FFF"; #>;float:<# echo $web[\'direction\']==\'bottom-right\'?\'right\':\'left\' #>;">\n    <img src=<# echo $web[\'iconSrc\'] || "//im.usingnet.com/build/v2/image/contact3.png"; #> alt="" style="width: 30px; height: 30px; display: block; margin: 0 auto; margin-top: 12px;">\n</div>\n<iframe src="about:blank" style="border: 0;"></iframe>\n\n'}),define("view/popup/PopUp",["lib/class","text!./PopUp.html","text!./PopUpMobile.html","lib/cookie","lib/template","lib/editor4screen","lib/browser","lib/ajax"],function(e,t,n,r,i,s,o,u){var a=document.createElement("div"),f=null,l="usingnet_im_id",c="is_chatting",h="_usingnet_socket";a.className="__usingnetClassNameForCustom",a.style.position="fixed",a.style.bottom="0",a.style.boxShadow="none",a.style.zIndex=2147483547;var p=0,d=function(){return parseInt(Math.random()*Math.pow(10,10)).toString(32)},v=function(){var e=parseInt((new Date).getTime()*Math.pow(10,4)+Math.random()*Math.pow(10,4)).toString(32);while(e.length<32)e+=d();return e.substr(0,32)},m=function(e,l,d,v){l.web,f=e,v&&(f+="&token="+v),l.web||(l.web={});var m=null,g=null,y=null,b=null,w=!l.plan,E=l.web.title_bg_color,S=l.web.direction.split("-");if(o.isMobile){if(E){var x=0;for(var T=1;T<7;T+=2)x+=parseInt("0x"+E.slice(T,T+2));x>=450?l.web.iconSrc="//im.usingnet.com/build/v2/image/contact4.png":l.web.iconSrc="//im.usingnet.com/build/v2/image/contact3.png"}a.innerHTML=i(n,l),a.style.bottom=(l.web.page_bottom_distance||"0")+"px",a.style.boxShadow="none",g=a.querySelector("iframe"),m=a.querySelector("div"),g.style.zIndex=2147483557,g.style.position="fixed",g.style.top=0,g.style.left=0,g.style.width="100%",g.style.height="100%",g.style.display="none"}else{a.innerHTML=i(t,l),g=a.querySelector("iframe"),m=a.querySelector("div")||a.querySelector("img"),y=a.querySelector(".__youxinCopyright"),b=a.querySelector(".usingnetUnreadMessageRemind"),a.style.bottom=(l.web.page_bottom_distance||"0")+"px";if(S[0]==="middle"){var N=a.querySelector("#__USINGNET_HOLDER");a.style.bottom=window.innerHeight/2+parseInt(N.style.height)/2+parseInt(l.web.page_distance)+"px"}S[1]=="left"?a.style.left=(l.web.page_distance||"20")+"px":a.style.right=(l.web.page_distance||"20")+"px",g.style.zIndex=2147483557,g.style.width="350px",g.style.height="440px",g.style.display="none"}return g.src=f,m.style.display="block",m.addEventListener("click",function(){function e(){if(!o.isMobile){var e=function(){g.style.display=g.style.display=="none"?"block":"none",m.style.display=m.style.display=="none"?"block":"none",w?y.style.display=y.style.display=="none"?"block":"none":"","none"===m.style.display&&b&&(b.style.display="none",p=0),g.style.display=="block"?(a.style.bottom="0px",a.style.boxShadow="rgba(0,0,0,0.5) 0 5px 10px"):(a.style.bottom=(l.web.page_bottom_distance||"0")+"px",a.style.boxShadow="none")};e()}else window.open(f)}r.set(c,1),v?e():u.jsonp("//im.usingnet.com/api/message/client",d,function(t){t.success&&(r.set(h,t.data),f+="&token="+t.data,g.src=f,g.onload=setTimeout(e,300))})}),window.addEventListener("message",function(e){if(e.data)try{var t=JSON.parse(e.data);switch(t.action){case"inviteDialogue":if("none"===g.style.display){var n=t.message,i=!!n.invite_closed;r.get("_USINGNET_INVITE_CLOSED",function(e){if(!i||i&&!e){var t=document.createElement("div");t.id="usingnet_invite_container",t.innerHTML='<div><img src="'+n.invite_img+'" /><p>'+n.invite_text.substr(0,27)+'</p><i class="inviteClose"></i></div>',document.body.appendChild(t);var s=t.querySelector("div");s.addEventListener("click",function(e){e.target.className==="inviteClose"?(this.style.display="none",i&&r.set("_USINGNET_INVITE_CLOSED",1)):("none"===g.style.display&&m.click(),this.style.display="none")},!1)}})}break;case"newMessage":"block"===m.style.display&&(p++,b&&(b.innerText=p>99?99:p,b.style.display="block"));break;case"minimize":g.style.display=g.style.display=="none"?"block":"none",m.style.display=m.style.display=="none"?"block":"none",w?y.style.display=y.style.display=="none"?"block":"none":"",a.style.bottom=(l.web.page_bottom_distance||"0")+"px",S[0]==="middle"&&(a.style.bottom=window.innerHeight/2+parseInt(l.web.page_distance)+"px"),a.style.boxShadow="none",r.set(c,0);break;case"cutScreen":s(document.body,function(e){g.contentWindow.postMessage(JSON.stringify({data:e,type:"image/png",encode:"base64",action:"sendScreen"}),"*")});break;default:}}catch(e){}},!1),{show:function(){var e=function(){g.style.display="block",m.style.display="none",w?y.style.display="block":"",a.style.bottom="0px",r.set(c,1),o.isMobile?a.style.boxShadow="none":a.style.boxShadow="rgba(0,0,0,0.5) 0 5px 10px",b&&(b.style.display="none",p=0)};try{g.src=="about:blank"?(g.src=f,g.onload=function(){setTimeout(e,500)}):e()}catch(t){}},hide:function(){g.style.display="none",m.style.display="block",w?y.style.display="none":"",a.style.bottom=(l.web.page_bottom_distance||"0")+"px",a.style.boxShadow="none",r.set(c,0)},getUrl:function(){return f}}};return(new e).extend(function(e,t,n){this.appendTo=function(e){e.appendChild(a)};var i=null;r.get(l,function(s){s||(s=v(),r.set(l,s));var o=d(),u=document.title,a=new Image,f=0,c=[1e3,3e3,5e3,12e3,24e3],p=function(){a.src="//im.usingnet.com/track/"+s+"/"+o+"?title="+encodeURIComponent(u)+"&referrer="+encodeURIComponent(document.referrer)+"&user_info="+(t?encodeURIComponent(JSON.stringify(t)):"")+"&team_token="+e+"&_="+Math.random(),setTimeout(p,c[f]?c[f]:6e4),f++};p();var g={to:e,from:s,user_info:t?encodeURIComponent(JSON.stringify(t)):""};r.get(h,function(r){var u="//im.usingnet.com/?tid="+e+"&track_id="+s+"&user_info="+(t?encodeURIComponent(JSON.stringify(t)):"")+"&page_id="+o;i=m(u,n,g,r)})}),this.show=function(){return i?(i.show(),!0):!1},this.hide=function(){return i?(i.hide(),!0):!1},this.getUrl=function(){return i?i.getUrl():!1},r.get(c,function(e){var t=!Boolean(navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i));"1"==e&&t&&i.show()})})}),define("text!view/lm/Lm.html",[],function(){return'<div class="lm" style="padding:20px;">\n    <form class="pure-form pure-form-stacked">\n        <fieldset>\n            <legend>当前暂无客服在线，请留言：</legend>\n            <div class="contact_info">\n                <div class="pure-control-group">\n                    <label for="lm_email">电子邮件</label>\n                    <input required="required" type="email" name="email" id="lm_email" placeholder="name@example.com"/>\n                </div>\n                <div class="pure-control-group">\n                    <label for="lm_phone">联系电话</label>\n                    <input required="required" type="text" name="phone" id="lm_phone" placeholder="13800000000" />\n                </div>\n            </div>\n            <label for="lm_message">留言</label>\n            <textarea class="pure-input-1" name="body" id="lm_message" placeholder="有什么可以帮助您"></textarea>\n\n            <input type="button" class="pure-button pure-button-primary" value="提交" />\n        </fieldset>\n    </form>\n    <div class="submitted" style="display: none">\n        <div class="alert-dialog">\n            <div class="content">\n                <p>留言提交成功。</p>\n                <p>客服稍后将联系您,请耐心等待。</p>\n                <input type="button" class="pure-button pure-button-primary" value="确定" />\n            </div>\n        </div>\n    </div>\n</div>'}),define("text!view/page/message/Message.html",[],function(){return'<!-- <dialog> -->\n    <h4><# echo $title; #><span class="fa fa-times pull-right" onclick="document.body.removeChild(this.parentElement.parentElement)"></span></h4>\n    <details>\n        <summary>\n            <# echo $summary; #>\n        </summary>\n        <# echo $detail; #>\n    </details>\n<!-- </dialog> -->'}),define("view/page/message/Message",["lib/class","lib/template","text!./Message.html"],function(e,t,n){var r=document.createElement("dialog");return new((new e).extend(function(){this.show=function(e,i,s){r.innerHTML=t(n,{title:e,summary:i,detail:s}),document.body.appendChild(r),typeof r.show=="function"&&r.show()},this.hide=function(){typeof r.close=="function"&&r.close(),document.body.removeChild(r)}}))}),define("view/lm/Lm",["lib/ajax","lib/class","text!./Lm.html","view/common/header/Header","lib/messager","view/page/message/Message","view/messagebubble/MessageBubble"],function(e,t,n,r,i,s,o){var u=document.createElement("div"),a=new r;u.innerHTML=n;var f=u.querySelector('input[type="button"]'),l=u.querySelector("textarea"),c=u.querySelector("form"),h=null;return f.addEventListener("click",function(){if(!h)return!1;var e=u.querySelectorAll("form input,textarea"),t={};for(var n=0;n<e.length;n++)e[n].name&&(t[e[n].name]=e[n].value);t.body.length&&h.send(t.body,t.email,t.phone,!0)}),(new t).extend(function(e,t,n,r,s){a.setConfig(s),s&&s.web&&s.web.input_placeholder&&(l.placeholder=s.web.input_placeholder),this.appendTo=function(e){a.appendTo(e),e.appendChild(u)},h=new i(t,e,r,s,n,"LM"),h.addEventListener("sent",function(){o.showSuccess("我们已经记录了您的留言, 客服上线后我们将与您联系。",5);var e=u.querySelectorAll("form input,textarea");for(var t=0;t<3;t++)e[t].value=""}),h.addEventListener("error",function(e){o.showError(e.data||"服务器错误",5)})})}),define("text!view/order/Order.html",[],function(){return'<div class="lm" style="padding:10px 20px;">\n    <form class="pure-form pure-form-stacked" onsubmit="return false;">\n        <fieldset>\n            <div class="pure-control-group">\n                <label for="lm_message">问题类型</label>\n                <select name="order_type" class="pure-input-1-2" style="padding: 0 5px 0 5px;" required="required">\n                    <option value="">-- 请选择 --</option>\n                <# for($i in $order){$type = $order[$i]; #>\n                    <option value="<# echo $type.title #>" <# if($current_title==$type.title){ #> selected="selected" <# } #> ><# echo $type.title #></option>\n                <# } #>\n                </select>\n            </div>\n            <# for($i in $order){$type = $order[$i]; if($type.title != $current_title){continue;} for($j in $type.items){$field = $type.items[$j]; #>\n                <# switch($field.type){ case \'textarea\': #>\n                    <div class="pure-control-group">\n                        <label for="lm_message"><# echo $field[\'placeholder\'] #></label>\n                        <textarea class="pure-input-1" name="body" id="lm_message" placeholder="<# echo $field[\'placeholder\'] #>" required="required"></textarea>\n                    </div>\n                <# break;case \'input\':default: #>\n                    <div class="pure-control-group">\n                        <label for="lm_phone"><# echo $field[\'placeholder\'] #></label>\n                        <input required="required" type="text" name="phone" id="lm_phone" placeholder="<# echo $field[\'placeholder\'] #>" required="required" />\n                    </div>\n                <# break; } #>\n            <# }} #>\n            <button type="submit" class="pure-button pure-button-primary" name="submit">提交</button>\n        </fieldset>\n    </form>\n    <div class="submitted" style="display: none">\n        <div class="alert-dialog">\n            <div class="content">\n                <p>留言提交成功。</p>\n                <p>客服稍后将联系您,请耐心等待。</p>\n                <input type="button" class="pure-button pure-button-primary" value="确定" />\n            </div>\n        </div>\n    </div>\n</div>'}),define("view/order/Order",["lib/ajax","lib/class","text!./Order.html","view/common/header/Header","lib/messager","view/page/message/Message","view/messagebubble/MessageBubble","lib/template"],function(e,t,n,r,i,s,o,u){var a=document.createElement("div"),f=new r;return a.innerHTML="",(new t).extend(function(e,t,r,s,l){a.innerHTML=u(n,l);var c=a.querySelector("form"),h=null;a.addEventListener("change",function(e){e.target.name=="order_type"&&(l.current_title=e.target.value,a.innerHTML=u(n,l))}),a.addEventListener("click",function(e){if(e.target.name=="submit"){if(!h)return!1;var t=a.querySelector("select").value;if(!t)return!1;var n=a.querySelectorAll("form input,textarea"),r={};for(var i=0;i<n.length;i++)if(n[i].placeholder){r[n[i].placeholder]=n[i].value;if(!r[n[i].placeholder])return!1}h.sendOrder(t,r)}}),f.setConfig(l),this.appendTo=function(e){f.appendTo(e),a.style.overflowY="scroll",a.style.marginTop=f.getHeight()+"px",a.style.height=document.body.scrollHeight-f.getHeight()+"px",e.appendChild(a)},h=new i(t,e,s,r,"LM"),h.addEventListener("sent",function(){o.showSuccess("工单已成功提交，请耐心等待。",5),setTimeout(function(){location.reload()},3e3)}),h.addEventListener("error",function(e){o.showError(e.data,5)})})}),requirejs(["lib/ajax","lib/url","lib/template","text!./theme.html","./view/im/serviceGroup/ServiceGroup","./view/im/Im","./view/messagebubble/MessageBubble","./view/popup/PopUp","./view/lm/Lm","./view/order/Order","./view/im/messageform/tools/Wiki"],function(e,t,n,r,i,s,o,u,a,f,l){if(location.host.match(/im.usingnet.com/)){var c=document.createElement("link");c.type="text/css",c.rel="stylesheet",requirejs.version?c.href="./src/v2/css/main.css":c.href="./build/v2/css/main.min.d526eb3c.css",document.getElementsByTagName("head")[0].appendChild(c),t.search("tid")&&t.search("track_id")&&t.search("page_id")?e.jsonp("/api/teaminfo/"+t.search("tid"),{track_id:t.search("track_id"),user_info:t.search("user_info")},function(o){o.web.invite&&setTimeout(function(){var e={action:"inviteDialogue",message:o.web};document.referrer&&window.parent.postMessage(JSON.stringify(e),document.referrer)},o.web.invite_wait_time*1e3);var u=document.createElement("div");u.innerHTML=n(r,o.web||{}),u.children.length&&document.body.appendChild(u.children[0]);if(location.href.match(/#wiki/g)){var c=new s(t.search("tid"),t.search("track_id"),t.search("page_id"),t.search("user_info"),o);c.appendTo(document.body),e.jsonp("/api/knowledge/"+t.search("wikiId"),{},function(e){new l(e,!0)});return}if(o.web.type=="ORDER"&&!o.current_order){var h=new f(t.search("tid"),t.search("track_id"),t.search("page_id"),t.search("user_info"),o);h.appendTo(document.body)}else if(o.online||o.web.type=="IM"){var c=new s(t.search("tid"),t.search("track_id"),t.search("page_id"),t.search("user_info"),o,t.search("token"));c.appendTo(document.body);if(o.web.display_agent_group){var p=new i(o);p.appendTo(document.body)}}else{var d=new a(t.search("tid"),t.search("track_id"),t.search("page_id"),t.search("user_info"),o);d.appendTo(document.body)}}):o.showError("初始化失败：缺少参数。",5)}else window.usingnetInit=function(t,n){typeof n=="undefined"&&(n=null);if(!t)return!1;try{e.jsonp("//im.usingnet.com/api/teaminfo/"+t,{},function(e){var r=new u(t,n,e);r.appendTo(document.body),window.usingnetCrm={show:function(){return r.show()},hide:function(){return r.hide()},getUrl:function(){return r.getUrl()}}})}catch(r){var i=new Image,s={message:r.description||r.message,script:r.name,line:r.stack||"",column:"",object:r},o=[];for(var a in s)o.push(encodeURIComponent(a)+"="+encodeURIComponent(s[a]));i.src="/api/log?"+o.join("&")+Math.random()*1e3}},typeof usingnetJsonP=="function"&&usingnetJsonP(window.usingnetInit)}),define("main",function(){});